var fb={db:null,config:{apiKey:"AIzaSyD0LhmulK6Hrn-m-gfhj3XFNUq2OgfEmzg",authDomain:"pogo-63931.firebaseapp.com",databaseURL:"https://pogo-63931.firebaseio.com",storageBucket:"pogo-63931.appspot.com"},start:function(){firebase.initializeApp(this.config),this.db=firebase.database()},onChildAdded:function(t,a){var i=this.db.ref(t);i.on("child_added",function(t){var i=t.val();a(i)})}};fb.start();var pokeapi={urlPrefix:"https://pokeapi.co/api/v2/pokemon/",getData:function(t,a){var i=this.urlPrefix+t;$.getJSON(i,function(t){var i=[];t.types.forEach(function(t){i.push(t.type.name)});var e={weight:t.weight,height:t.height,types:i,status:"ok"};a(e)}).fail(function(){var t={weight:null,height:null,types:null,status:"fail"};a(t)})}},map,infoWindow,initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:19.725862,lng:-155.06906},zoom:16}),infoWindow=new google.maps.InfoWindow},googleError=function(){document.getElementById("map").innerHTML="<h1>Sorry, Google Maps is unavailable at the moment</h1><p>Please try again later.</p>"},pogosnap={urlPrefix:"https://www.reddit.com/r/PokemonGoSnap/search.json?",params:{restrict_sr:"true",limit:"1",sort:"top"},getData:function(t,a){var i=this,e=i.urlPrefix;e+="q="+t.name,e+="&restrict_sr="+i.params.restrict_sr,e+="&limit="+i.params.limit,e+="&sort="+i.params.sort;$.getJSON(e,function(t){var e=t.data.children[0].data;if(void 0!==e){var r={picture:i.fixUrl(e.url),author:e.author,permalink:"https://www.reddit.com"+e.permalink,status:"ok"};a(r)}else{var o={picture:"#",author:"",permalink:"",status:"noresults"};a(o)}}).fail(function(){var t={picture:"#",author:"",permalink:"",status:"fail"};a(t)})},fixUrl:function(t){var a=t;return t.search("reddituploads")&&(a=t.split("&amp;").join("&")),t.search("imgur")&&t.search(".jpg")===-1&&(a+=".jpg"),a}};
var Pokemon=function(e,n){var i=this;i.id=e,i.name=n,i.icon="",i.types=[],i.weight="",i.height="",i.pokeapiStatus=null,i.picture="",i.author="",i.permalink="#",i.pogosnapStatus=null,i.setIcon=function(){var e="img/",n=".png",o=i.id.toString();i.id<10?o="00"+o:i.id<100&&(o="0"+o),i.icon=e+o+n},i.setIcon()},Location=function(e,n,i,o,t){var a=this;a.id=e,a.type=n,a.lat=i,a.lng=o,a.name=t,a.icon="img/"+n+".png",a.markerCreated=!1,a.streetViewUrl="",a.setStreetViewUrl=function(){var e="https://maps.googleapis.com/maps/api/streetview?",n={location:a.lat+","+a.lng,size:"300x200",key:"AIzaSyDnmyJXbQ5xflnzlvc1dJetLgJPbNerL-o"};e+="location="+n.location,e+="&size="+n.size,e+="&key="+n.key,a.streetViewUrl=e},a.openInfoWindow=function(){infoWindow.setContent(MapView.fillTemplate(a)),infoWindow.open(map,model.markers[a.id]),model.markers[a.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[a.id].setAnimation(null)},1420),$(".drawer").drawer("close")},a.setStreetViewUrl()},SpawnLocation=function(e,n,i,o){var t=this;t.id=e,t.type="spawn",t.lat=n,t.lng=i,t.name="",t.icon="",t.poke_id=o,t.openInfoWindow=function(){infoWindow.setContent(MapView.fillTemplate(t)),infoWindow.open(map,model.markers[t.id]),model.markers[t.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[t.id].setAnimation(null)},1420)},t.updatePokemon=function(e){t.poke_id=e.id,t.name=e.name,t.icon=e.icon}},model={pokemons:[],locations:[],markers:[]};
var MapView={createMarker:function(i){var o=this;void 0===model.markers[i.id]?(model.markers[i.id]=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:map,icon:i.icon,title:i.name,id:i.id}),model.markers[i.id].addListener("click",function(){infoWindow.setContent(o.fillTemplate(i)),infoWindow.open(map,model.markers[i.id]),model.markers[i.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[i.id].setAnimation(null)},1420)})):console.log("Marker already created for location:",i.name)},template:'<div id="loc-%id%"><h3>%name%</h3><p>(%lat%, %lng%)</p><p>Google Street View: </p><img src="%streetview%" alt="%name%"></div>',spawnTemplate:'<div id="loc-%id%"><h3>#%pokemon_id% %name%</h3><p>(%lat%, %lng%)</p>%pogosnapStatus%<div class="pic"%pogosnapHidden%><img src="%picture%" alt="%name%" style="width: 15em; height: 15em; object-fit: cover;"><p>Image Source: <a href="%permalink%">/r/PokemonGoSnap</a><br>Posted by: %author%</p></div>%pokeapiStatus%<div class="bio" %pokeapiHidden%><ul><li>Types: %types%</li><li>Weight: %weight% kg</li><li>Height: %height% m</li></ul></div></div>',fillTemplate:function(i){var o,e=model.pokemons[i.poke_id];if("spawn"===i.type)if(o=this.spawnTemplate,o=o.split("%pokemon_id%").join(i.poke_id),o=o.split("%picture%").join(e.picture),"ok"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(""),o=o.split("%pogosnapStatus%").join(""),o=o.split("%author%").join(e.author),o=o.split("%permalink%").join(e.permalink)):"noresults"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Pokemon does not have a picture</p>")):"loading"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join('<p>Loading picture...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Error loading picture from Reddit</p>")),"ok"===e.pokeapiStatus){o=o.split("%pogoapiHidden%").join(""),o=o.split("%pokeapiStatus%").join(""),o=o.split("%weight%").join(e.weight/10),o=o.split("%height%").join(e.height/10);var t=e.types.join(", ");o=o.split("%types%").join(t)}else"loading"===e.pokeapiStatus?(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join('<p>Loading stats...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join("<p>Error loading stats from Pokeapi</p>"));else o=this.template,o=o.split("%streetview%").join(i.streetViewUrl);return o=o.split("%id%").join(i.id),o=o.split("%type%").join(i.type),o=o.split("%lat%").join(i.lat),o=o.split("%lng%").join(i.lng),o=o.split("%name%").join(i.name),o=o.split("%icon%").join(i.icon)}};
var ListViewViewModel=function(){var e=this;e.query=ko.observable(""),e.locations=ko.observableArray(),e.filteredLocations=ko.computed(function(){var o=e.query().toLowerCase(),r=[];return e.locations().sort(function(e,o){e.name.toLowerCase(),o.name.toLowerCase();return e.name>o.name?1:e.name<o.name?-1:0}),""===o?(model.markers.forEach(function(e){e.setVisible(!0)}),e.locations()):(model.markers.forEach(function(e){e.setVisible(!1)}),e.locations().forEach(function(e){var a=e.name.toLowerCase(),i=e.type.toLowerCase();(a.search(o)>-1||i.search(o)>-1)&&(model.markers[e.id].setVisible(!0),r.push(e),console.log(e))}),r)})},listView=new ListViewViewModel;ko.applyBindings(listView),$(document).ready(function(){$(".drawer").drawer()});
var controller={init:function(){var o=this;o.updateGyms(),o.updateSpawns(),o.updatePokeStops()},updateGyms:function(){fb.onChildAdded("gyms",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"gym",n,a,t);MapView.createMarker(p),listView.locations.push(p)})},updatePokeStops:function(){fb.onChildAdded("pokestops",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"pokestop",n,a,t);MapView.createMarker(p),listView.locations.push(p)})},updateSpawns:function(){fb.onChildAdded("spawns",function(o){var e=o.id,t=o.pokemon_id,n=o.pokemon_name,a=o.lat,p=o.lng;model.locations[e]=new SpawnLocation(e,a,p,t),void 0===model.pokemons[t]?(model.pokemons[t]=new Pokemon(t,n),model.locations[e].updatePokemon(model.pokemons[t]),MapView.createMarker(model.locations[e]),listView.locations.push(model.locations[e])):(model.locations[e].updatePokemon(model.pokemons[t]),MapView.createMarker(model.locations[e]),listView.locations.push(model.locations[e])),"loading"!==model.pokemons[t].pogoSnapStatus&&(model.pokemons[t].pogoSnapStatus="loading",pogosnap.getData(model.pokemons[t],function(o){model.pokemons[t].picture=o.picture,model.pokemons[t].permalink=o.permalink,model.pokemons[t].author=o.author,model.pokemons[t].pogosnapStatus=o.status})),"loading"!==model.pokemons[t].pokeapiStatus&&(model.pokemons[t].pokeapiStatus="loading",pokeapi.getData(t,function(o){model.pokemons[t].weight=o.weight,model.pokemons[t].height=o.height,model.pokemons[t].types=o.types,model.pokemons[t].pokeapiStatus=o.status}))})}};controller.init();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwaXMuanMiLCJtb2RlbC5qcyIsInZpZXcuanMiLCJsaXN0dmlldy5qcyIsImNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiZmIiLCJkYiIsImNvbmZpZyIsImFwaUtleSIsImF1dGhEb21haW4iLCJkYXRhYmFzZVVSTCIsInN0b3JhZ2VCdWNrZXQiLCJzdGFydCIsImZpcmViYXNlIiwiaW5pdGlhbGl6ZUFwcCIsInRoaXMiLCJkYXRhYmFzZSIsIm9uQ2hpbGRBZGRlZCIsInJlZiIsImNiIiwibXlSZWYiLCJvbiIsInNuYXAiLCJkYXRhIiwidmFsIiwicG9rZWFwaSIsInVybFByZWZpeCIsImdldERhdGEiLCJpZCIsInVybCIsIiQiLCJnZXRKU09OIiwibXlUeXBlcyIsInR5cGVzIiwiZm9yRWFjaCIsInR5cGUiLCJwdXNoIiwibmFtZSIsIm15RGF0YSIsIndlaWdodCIsImhlaWdodCIsInN0YXR1cyIsImZhaWwiLCJub0RhdGEiLCJtYXAiLCJpbmZvV2luZG93IiwiaW5pdE1hcCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2VudGVyIiwibGF0IiwibG5nIiwiem9vbSIsIkluZm9XaW5kb3ciLCJnb29nbGVFcnJvciIsImlubmVySFRNTCIsInBvZ29zbmFwIiwicGFyYW1zIiwicmVzdHJpY3Rfc3IiLCJsaW1pdCIsInNvcnQiLCJwb2tlbW9uIiwic2VsZiIsImxpc3RpbmciLCJjaGlsZHJlbiIsInVuZGVmaW5lZCIsInBpY3R1cmUiLCJmaXhVcmwiLCJhdXRob3IiLCJwZXJtYWxpbmsiLCJuZXdVcmwiLCJzZWFyY2giLCJzcGxpdCIsImpvaW4iLCJQb2tlbW9uIiwiaWNvbiIsInBva2VhcGlTdGF0dXMiLCJwb2dvc25hcFN0YXR1cyIsInNldEljb24iLCJsb2NhdGlvbiIsInRocmVlRGlnaXRJZCIsInRvU3RyaW5nIiwiTG9jYXRpb24iLCJtYXJrZXJDcmVhdGVkIiwic3RyZWV0Vmlld1VybCIsInNldFN0cmVldFZpZXdVcmwiLCJzaXplIiwia2V5Iiwib3BlbkluZm9XaW5kb3ciLCJzZXRDb250ZW50IiwiTWFwVmlldyIsImZpbGxUZW1wbGF0ZSIsIm9wZW4iLCJtb2RlbCIsIm1hcmtlcnMiLCJzZXRBbmltYXRpb24iLCJBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0IiwiZHJhd2VyIiwiU3Bhd25Mb2NhdGlvbiIsInBva2VfaWQiLCJ1cGRhdGVQb2tlbW9uIiwicG9rZW1vbnMiLCJsb2NhdGlvbnMiLCJjcmVhdGVNYXJrZXIiLCJNYXJrZXIiLCJwb3NpdGlvbiIsInRpdGxlIiwiYWRkTGlzdGVuZXIiLCJjb25zb2xlIiwibG9nIiwidGVtcGxhdGUiLCJzcGF3blRlbXBsYXRlIiwiY29udGVudCIsIkxpc3RWaWV3Vmlld01vZGVsIiwicXVlcnkiLCJrbyIsIm9ic2VydmFibGUiLCJvYnNlcnZhYmxlQXJyYXkiLCJmaWx0ZXJlZExvY2F0aW9ucyIsImNvbXB1dGVkIiwiZmlsdGVyIiwidG9Mb3dlckNhc2UiLCJhIiwiYiIsIm1hcmtlciIsInNldFZpc2libGUiLCJsb2MiLCJsaXN0VmlldyIsImFwcGx5QmluZGluZ3MiLCJyZWFkeSIsImNvbnRyb2xsZXIiLCJpbml0IiwidXBkYXRlR3ltcyIsInVwZGF0ZVNwYXducyIsInVwZGF0ZVBva2VTdG9wcyIsImxvY2F0aW9uX2lkIiwiZ3ltIiwicG9rZXN0b3AiLCJsb2NfaWQiLCJwb2tlbW9uX2lkIiwicG9rZW1vbl9uYW1lIiwicG9nb1NuYXBTdGF0dXMiLCJwaWNEYXRhIiwiYmlvRGF0YSJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsS0FDRkMsR0FBSyxLQUNMQyxRQUNFQyxPQUFRLDBDQUNSQyxXQUFZLDZCQUNaQyxZQUFhLG9DQUNiQyxjQUFlLDBCQUVqQkMsTUFBUSxXQUNOQyxTQUFTQyxjQUFjQyxLQUFLUixRQUM1QlEsS0FBS1QsR0FBS08sU0FBU0csWUFFckJDLGFBQWUsU0FBVUMsRUFBS0MsR0FDNUIsR0FBSUMsR0FBUUwsS0FBS1QsR0FB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QUkyQyxPQUFTNEUsRUFBUTVFLE9BQ3BDeUIsTUFBTVUsU0FBUzlFLEdBQUlvRCxlQUFpQm1FLEVBQVExRyxVQUtQLFlBQXJDdUQsTUFBTVUsU0FBUzlFLEdBQUltRCxnQkFDckJpQixNQUFNVSxTQUFTOUUsR0FBSW1ELGNBQWdCLFVBQ25DdEQsUUFBUUUsUUFBUUMsRUFBSSxTQUFVd0gsR0FDNUJwRCxNQUFNVSxTQUFTOUUsR0FBSVcsT0FBUzZHLEVBQVE3RyxPQUNwQ3lELE1BQU1VLFNBQVM5RSxHQUFJWSxPQUFTNEcsRUFBUTVHLE9BQ3BDd0QsTUFBTVUsU0FBUzlFLEdBQUlLLE1BQVFtSCxFQUFRbkgsTUFDbkMrRCxNQUFNVSxTQUFTOUUsR0FBSW1ELGNBQWdCcUUsRUFBUTNHLGFBTXJEOEYsWUFBV0MiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpcmViYXNlXHJcbnZhciBmYiA9IHtcclxuICBkYiA6IG51bGwsXHJcbiAgY29uZmlnIDoge1xyXG4gICAgYXBpS2V5OiBcIkFJemFTeUQwTGhtdWxLNkhybi1tLWdmaGozWEZOVXEyT2dmRW16Z1wiLFxyXG4gICAgYXV0aERvbWFpbjogXCJwb2dvLTYzOTMxLmZpcmViYXNlYXBwLmNvbVwiLFxyXG4gICAgZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly9wb2dvLTYzOTMxLmZpcmViYXNlaW8uY29tXCIsXHJcbiAgICBzdG9yYWdlQnVja2V0OiBcInBvZ28tNjM5MzEuYXBwc3BvdC5jb21cIixcclxuICB9LFxyXG4gIHN0YXJ0IDogZnVuY3Rpb24gKCkge1xyXG4gICAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcCh0aGlzLmNvbmZpZyk7XHJcbiAgICB0aGlzLmRiID0gZmlyZWJhc2UuZGF0YWJhc2UoKTtcclxuICB9LFxyXG4gIG9uQ2hpbGRBZGRlZCA6IGZ1bmN0aW9uIChyZWYsIGNiKSB7XHJcbiAgICB2YXIgbXlSZWYgPSB0aGlzLmRiLnJlZihyZWYpO1xyXG4gICAgbXlSZWYub24oJ2NoaWxkX2FkZGVkJywgZnVuY3Rpb24gKHNuYXApIHtcclxuICAgICAgdmFyIGRhdGEgPSBzbmFwLnZhbCgpO1xyXG4gICAgICBjYihkYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxufTtcclxuZmIuc3RhcnQoKTtcclxuLy8gUG9rZWFwaVxyXG52YXIgcG9rZWFwaSA9IHtcclxuICB1cmxQcmVmaXggOiAnaHR0cHM6Ly9wb2tlYXBpLmNvL2FwaS92Mi9wb2tlbW9uLycsXHJcbiAgZ2V0RGF0YSA6IGZ1bmN0aW9uIChpZCwgY2IpIHtcclxuICAgIHZhciB1cmwgPSB0aGlzLnVybFByZWZpeCArIGlkO1xyXG4gICAgdmFyIGpxeGhyID0gJC5nZXRKU09OKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgdmFyIG15VHlwZXMgPSBbXTtcclxuICAgICAgZGF0YS50eXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgbXlUeXBlcy5wdXNoKHR5cGUudHlwZS5uYW1lKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHZhciBteURhdGEgPSB7XHJcbiAgICAgICAgd2VpZ2h0OiBkYXRhLndlaWdodCxcclxuICAgICAgICBoZWlnaHQ6IGRhdGEuaGVpZ2h0LFxyXG4gICAgICAgIHR5cGVzOiBteVR5cGVzLFxyXG4gICAgICAgIHN0YXR1czogJ29rJyxcclxuICAgICAgfTtcclxuICAgICAgY2IobXlEYXRhKTtcclxuICAgIH0pXHJcbiAgICAuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHZhciBub0RhdGEgPSB7XHJcbiAgICAgICAgd2VpZ2h0OiBudWxsLFxyXG4gICAgICAgIGhlaWdodDogbnVsbCxcclxuICAgICAgICB0eXBlczogbnVsbCxcclxuICAgICAgICBzdGF0dXM6ICdmYWlsJ1xyXG4gICAgICB9O1xyXG4gICAgICBjYihub0RhdGEpO1xyXG4gICAgfSk7XHJcbiAgfSxcclxufTtcclxuLy8gR29vZ2xlIE1hcHNcclxudmFyIG1hcCwgaW5mb1dpbmRvdztcclxudmFyIGluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIGNlbnRlcjoge2xhdDogMTkuNzI1ODYyLCBsbmc6IC0xNTUuMDY5MDZ9LFxyXG4gICAgem9vbTogMTZcclxuICB9KTtcclxuICBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcclxufTtcclxudmFyIGdvb2dsZUVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKS5pbm5lckhUTUwgPSAnPGgxPlNvcnJ5LCBHb29nbGUgTWFwcyBpcyB1bmF2YWlsYWJsZSBhdCB0aGUgbW9tZW50PC9oMT48cD5QbGVhc2UgdHJ5IGFnYWluIGxhdGVyLjwvcD4nO1xyXG59O1xyXG4vLyBSZWRkaXQgL3IvUG9rZW1vbkdvU25hcFxyXG52YXIgcG9nb3NuYXAgPSB7XHJcbiAgdXJsUHJlZml4IDogJ2h0dHBzOi8vd3d3LnJlZGRpdC5jb20vci9Qb2tlbW9uR29TbmFwL3NlYXJjaC5qc29uPycsXHJcbiAgcGFyYW1zIDoge1xyXG4gICAgcmVzdHJpY3Rfc3IgOiAndHJ1ZScsXHJcbiAgICBsaW1pdCA6ICcxJyxcclxuICAgIHNvcnQgOiAndG9wJ1xyXG4gIH0sXHJcbiAgZ2V0RGF0YSA6IGZ1bmN0aW9uIChwb2tlbW9uLCBjYikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIHVybCA9IHNlbGYudXJsUHJlZml4O1xyXG4gICAgdXJsICs9ICdxPScgKyBwb2tlbW9uLm5hbWU7XHJcbiAgICB1cmwgKz0gJyZyZXN0cmljdF9zcj0nICsgc2VsZi5wYXJhbXMucmVzdHJpY3Rfc3I7XHJcbiAgICB1cmwgKz0gJyZsaW1pdD0nICsgc2VsZi5wYXJhbXMubGltaXQ7XHJcbiAgICB1cmwgKz0gJyZzb3J0PScgKyBzZWxmLnBhcmFtcy5zb3J0O1xyXG5cclxuICAgIHZhciBqcXhociA9ICQuZ2V0SlNPTih1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsaXN0aW5nID0gZGF0YS5kYXRhLmNoaWxkcmVuWzBdLmRhdGE7XHJcbiAgICAgIGlmIChsaXN0aW5nICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YXIgbXlEYXRhID0ge1xyXG4gICAgICAgICAgcGljdHVyZTogc2VsZi5maXhVcmwobGlzdGluZy51cmwpLFxyXG4gICAgICAgICAgYXV0aG9yOiBsaXN0aW5nLmF1dGhvcixcclxuICAgICAgICAgIHBlcm1hbGluazogJ2h0dHBzOi8vd3d3LnJlZGRpdC5jb20nICsgbGlzdGluZy5wZXJtYWxpbmssXHJcbiAgICAgICAgICBzdGF0dXM6ICdvaydcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNiKG15RGF0YSk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIG5vRGF0YSA9IHtcclxuICAgICAgICAgIHBpY3R1cmU6ICcjJyxcclxuICAgICAgICAgIGF1dGhvcjogJycsXHJcbiAgICAgICAgICBwZXJtYWxpbms6ICcnLFxyXG4gICAgICAgICAgc3RhdHVzOiAnbm9yZXN1bHRzJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY2Iobm9EYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIC5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIG5vRGF0YSA9IHtcclxuICAgICAgICBwaWN0dXJlOiAnIycsXHJcbiAgICAgICAgYXV0aG9yOiAnJyxcclxuICAgICAgICBwZXJtYWxpbms6ICcnLFxyXG4gICAgICAgIHN0YXR1czogJ2ZhaWwnXHJcbiAgICAgIH07XHJcbiAgICAgIGNiKG5vRGF0YSk7XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIGZpeFVybCA6IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgIHZhciBuZXdVcmwgPSB1cmw7XHJcbiAgICBpZiAodXJsLnNlYXJjaCgncmVkZGl0dXBsb2FkcycpKSB7XHJcbiAgICAgIG5ld1VybCA9IHVybC5zcGxpdCgnJmFtcDsnKS5qb2luKCcmJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodXJsLnNlYXJjaCgnaW1ndXInKSAmJiB1cmwuc2VhcmNoKCcuanBnJykgPT09IC0xKSB7XHJcbiAgICAgIG5ld1VybCArPSAnLmpwZyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VXJsO1xyXG4gIH0sXHJcbn07XHJcbiIsIi8vIFBva2Vtb24gQ2xhc3NcclxudmFyIFBva2Vtb24gPSBmdW5jdGlvbiAoaWQsIG5hbWUpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5pZCA9IGlkO1xyXG4gIHNlbGYubmFtZSA9IG5hbWU7XHJcbiAgc2VsZi5pY29uID0gJyc7XHJcbiAgLy8gVXBkYXRlZCBmcm9tIFBva2VhcGk6XHJcbiAgc2VsZi50eXBlcyA9IFtdO1xyXG4gIHNlbGYud2VpZ2h0ID0gJyc7XHJcbiAgc2VsZi5oZWlnaHQgPSAnJztcclxuICBzZWxmLnBva2VhcGlTdGF0dXMgPSBudWxsO1xyXG4gIC8vIFVwZGF0ZWQgZnJvbSAvci9Qb2tlbW9uR29TbmFwOlxyXG4gIHNlbGYucGljdHVyZSA9ICcnO1xyXG4gIHNlbGYuYXV0aG9yID0gJyc7XHJcbiAgc2VsZi5wZXJtYWxpbmsgPSAnIyc7XHJcbiAgc2VsZi5wb2dvc25hcFN0YXR1cyA9IG51bGw7XHJcblxyXG4gIHNlbGYuc2V0SWNvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBsb2NhdGlvbiA9ICdpbWcvJztcclxuICAgIHZhciB0eXBlID0gJy5wbmcnO1xyXG4gICAgdmFyIHRocmVlRGlnaXRJZCA9IHNlbGYuaWQudG9TdHJpbmcoKTtcclxuICAgIGlmIChzZWxmLmlkIDwgMTApIHtcclxuICAgICAgdGhyZWVEaWdpdElkID0gJzAwJyArIHRocmVlRGlnaXRJZDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHNlbGYuaWQgPCAxMDApIHtcclxuICAgICAgdGhyZWVEaWdpdElkID0gJzAnICsgdGhyZWVEaWdpdElkO1xyXG4gICAgfVxyXG4gICAgc2VsZi5pY29uID0gbG9jYXRpb24gKyB0aHJlZURpZ2l0SWQgKyB0eXBlO1xyXG4gIH07XHJcbiAgc2VsZi5zZXRJY29uKCk7XHJcbn07XHJcbi8vIExvY2F0aW9uIENsYXNzXHJcbnZhciBMb2NhdGlvbiA9IGZ1bmN0aW9uIChpZCwgdHlwZSwgbGF0LCBsbmcsIG5hbWUpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5pZCA9IGlkO1xyXG4gIHNlbGYudHlwZSA9IHR5cGU7IC8vIGd5bSwgcG9rZXN0b3BcclxuICBzZWxmLmxhdCA9IGxhdDtcclxuICBzZWxmLmxuZyA9IGxuZztcclxuICBzZWxmLm5hbWUgPSBuYW1lO1xyXG4gIHNlbGYuaWNvbiA9ICdpbWcvJyArIHR5cGUgKyAnLnBuZyc7XHJcbiAgc2VsZi5tYXJrZXJDcmVhdGVkID0gZmFsc2U7XHJcbiAgc2VsZi5zdHJlZXRWaWV3VXJsID0gJyc7XHJcbiAgc2VsZi5zZXRTdHJlZXRWaWV3VXJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHVybCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvc3RyZWV0dmlldz8nO1xyXG4gICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgbG9jYXRpb24gOiBzZWxmLmxhdCArICcsJyArIHNlbGYubG5nLFxyXG4gICAgICBzaXplIDogJzMwMHgyMDAnLFxyXG4gICAgICBrZXkgOiAnQUl6YVN5RG5teUpYYlE1eGZsbnpsdmMxZEpldExnSlBiTmVyTC1vJ1xyXG4gICAgfTtcclxuICAgIHVybCArPSAnbG9jYXRpb249JyArIHBhcmFtcy5sb2NhdGlvbjtcclxuICAgIHVybCArPSAnJnNpemU9JyArIHBhcmFtcy5zaXplO1xyXG4gICAgdXJsICs9ICcma2V5PScgKyBwYXJhbXMua2V5O1xyXG4gICAgc2VsZi5zdHJlZXRWaWV3VXJsID0gdXJsO1xyXG4gIH07XHJcbiAgc2VsZi5vcGVuSW5mb1dpbmRvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChNYXBWaWV3LmZpbGxUZW1wbGF0ZShzZWxmKSk7XHJcbiAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtb2RlbC5tYXJrZXJzW3NlbGYuaWRdKTtcclxuICAgIC8vIEJvdW5jZSB0d2ljZSBvbiBjbGlja1xyXG4gICAgbW9kZWwubWFya2Vyc1tzZWxmLmlkXS5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgbW9kZWwubWFya2Vyc1tzZWxmLmlkXS5zZXRBbmltYXRpb24obnVsbCk7XHJcbiAgICB9LCAxNDIwKTtcclxuICAgICQoJy5kcmF3ZXInKS5kcmF3ZXIoJ2Nsb3NlJyk7XHJcbiAgfTtcclxuICBzZWxmLnNldFN0cmVldFZpZXdVcmwoKTtcclxufTtcclxuLy8gU3Bhd24gTG9jYXRpb24gQ2xhc3NcclxudmFyIFNwYXduTG9jYXRpb24gPSBmdW5jdGlvbiAoaWQsIGxhdCwgbG5nLCBwb2tlX2lkKSB7XHJcbiAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gIHNlbGYuaWQgPSBpZDtcclxuICBzZWxmLnR5cGUgPSAnc3Bhd24nO1xyXG4gIHNlbGYubGF0ID0gbGF0O1xyXG4gIHNlbGYubG5nID0gbG5nO1xyXG4gIHNlbGYubmFtZSA9ICcnO1xyXG4gIHNlbGYuaWNvbiA9ICcnO1xyXG4gIHNlbGYucG9rZV9pZCA9IHBva2VfaWQ7XHJcbiAgc2VsZi5vcGVuSW5mb1dpbmRvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChNYXBWaWV3LmZpbGxUZW1wbGF0ZShzZWxmKSk7XHJcbiAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtb2RlbC5tYXJrZXJzW3NlbGYuaWRdKTtcclxuICAgIG1vZGVsLm1hcmtlcnNbc2VsZi5pZF0uc2V0QW5pbWF0aW9uKGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5CT1VOQ0UpO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgIG1vZGVsLm1hcmtlcnNbc2VsZi5pZF0uc2V0QW5pbWF0aW9uKG51bGwpO1xyXG4gICAgfSwgMTQyMCk7XHJcbiAgfTtcclxuICBzZWxmLnVwZGF0ZVBva2Vtb24gPSBmdW5jdGlvbiAocG9rZW1vbikge1xyXG4gICAgc2VsZi5wb2tlX2lkID0gcG9rZW1vbi5pZDtcclxuICAgIHNlbGYubmFtZSA9IHBva2Vtb24ubmFtZTtcclxuICAgIHNlbGYuaWNvbiA9IHBva2Vtb24uaWNvbjtcclxuICB9O1xyXG59O1xyXG5cclxudmFyIG1vZGVsID0ge1xyXG4gIHBva2Vtb25zIDogW10sXHJcbiAgbG9jYXRpb25zIDogW10sXHJcbiAgbWFya2VycyA6IFtdLFxyXG59O1xyXG4iLCJ2YXIgTWFwVmlldyA9IHtcclxuICBjcmVhdGVNYXJrZXIgOiBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGlmIChtb2RlbC5tYXJrZXJzW2xvY2F0aW9uLmlkXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgcG9zaXRpb246IHtsYXQ6IGxvY2F0aW9uLmxhdCwgbG5nOiBsb2NhdGlvbi5sbmd9LFxyXG4gICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgIGljb246IGxvY2F0aW9uLmljb24sXHJcbiAgICAgICAgdGl0bGU6IGxvY2F0aW9uLm5hbWUsXHJcbiAgICAgICAgaWQ6IGxvY2F0aW9uLmlkXHJcbiAgICAgIH0pO1xyXG4gICAgICBtb2RlbC5tYXJrZXJzW2xvY2F0aW9uLmlkXS5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gT3BlbiBpbmZvd2luZG93XHJcbiAgICAgICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KHNlbGYuZmlsbFRlbXBsYXRlKGxvY2F0aW9uKSk7XHJcbiAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCwgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0pO1xyXG4gICAgICAgIC8vIEJvdW5jZSB0d2ljZSBvbiBjbGlja1xyXG4gICAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdLnNldEFuaW1hdGlvbihudWxsKTtcclxuICAgICAgICB9LCAxNDIwKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coJ01hcmtlciBhbHJlYWR5IGNyZWF0ZWQgZm9yIGxvY2F0aW9uOicsIGxvY2F0aW9uLm5hbWUpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgdGVtcGxhdGUgOlxyXG5cclxuICAnPGRpdiBpZD1cImxvYy0laWQlXCI+JyArXHJcbiAgICAnPGgzPiVuYW1lJTwvaDM+JyArXHJcbiAgICAnPHA+KCVsYXQlLCAlbG5nJSk8L3A+JyArXHJcbiAgICAnPHA+R29vZ2xlIFN0cmVldCBWaWV3OiA8L3A+JyArXHJcbiAgICAnPGltZyBzcmM9XCIlc3RyZWV0dmlldyVcIiBhbHQ9XCIlbmFtZSVcIj4nICtcclxuICAnPC9kaXY+JyxcclxuXHJcbiAgc3Bhd25UZW1wbGF0ZSA6XHJcblxyXG4gICc8ZGl2IGlkPVwibG9jLSVpZCVcIj4nICtcclxuICAgICc8aDM+IyVwb2tlbW9uX2lkJSAlbmFtZSU8L2gzPicgK1xyXG4gICAgJzxwPiglbGF0JSwgJWxuZyUpPC9wPicgK1xyXG4gICAgJyVwb2dvc25hcFN0YXR1cyUnICtcclxuICAgICc8ZGl2IGNsYXNzPVwicGljXCIlcG9nb3NuYXBIaWRkZW4lPicgK1xyXG4gICAgICAnPGltZyBzcmM9XCIlcGljdHVyZSVcIiBhbHQ9XCIlbmFtZSVcIiBzdHlsZT1cIndpZHRoOiAxNWVtOyBoZWlnaHQ6IDE1ZW07IG9iamVjdC1maXQ6IGNvdmVyO1wiPicgK1xyXG4gICAgICAnPHA+JyArXHJcbiAgICAgICAgJ0ltYWdlIFNvdXJjZTogPGEgaHJlZj1cIiVwZXJtYWxpbmslXCI+L3IvUG9rZW1vbkdvU25hcDwvYT48YnI+JyArXHJcbiAgICAgICAgJ1Bvc3RlZCBieTogJWF1dGhvciUnICtcclxuICAgICAgJzwvcD4nICtcclxuICAgICc8L2Rpdj4nICtcclxuICAgICclcG9rZWFwaVN0YXR1cyUnICtcclxuICAgICc8ZGl2IGNsYXNzPVwiYmlvXCIgJXBva2VhcGlIaWRkZW4lPicgK1xyXG4gICAgICAnPHVsPicgK1xyXG4gICAgICAgICc8bGk+VHlwZXM6ICV0eXBlcyU8L2xpPicgK1xyXG4gICAgICAgICc8bGk+V2VpZ2h0OiAld2VpZ2h0JSBrZzwvbGk+JyArXHJcbiAgICAgICAgJzxsaT5IZWlnaHQ6ICVoZWlnaHQlIG08L2xpPicgK1xyXG4gICAgICAnPC91bD4nICtcclxuICAgICc8L2Rpdj4nK1xyXG4gICc8L2Rpdj4nLFxyXG5cclxuICBmaWxsVGVtcGxhdGUgOiBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgIHZhciBjb250ZW50O1xyXG4gICAgdmFyIHBva2Vtb24gPSBtb2RlbC5wb2tlbW9uc1tsb2NhdGlvbi5wb2tlX2lkXTtcclxuXHJcbiAgICAvLyBQb2tlbW9uIHNwZWNpZmljIHRlbXBsYXRlIGl0ZW1zOlxyXG4gICAgaWYgKGxvY2F0aW9uLnR5cGUgPT09ICdzcGF3bicpIHtcclxuICAgICAgY29udGVudCA9IHRoaXMuc3Bhd25UZW1wbGF0ZTtcclxuICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlbW9uX2lkJScpLmpvaW4obG9jYXRpb24ucG9rZV9pZCk7XHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcGljdHVyZSUnKS5qb2luKHBva2Vtb24ucGljdHVyZSk7XHJcblxyXG4gICAgICBpZiAocG9rZW1vbi5wb2dvc25hcFN0YXR1cyA9PT0gJ29rJykge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBIaWRkZW4lJykuam9pbignJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcFN0YXR1cyUnKS5qb2luKCcnKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWF1dGhvciUnKS5qb2luKHBva2Vtb24uYXV0aG9yKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBlcm1hbGluayUnKS5qb2luKHBva2Vtb24ucGVybWFsaW5rKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSBpZiAocG9rZW1vbi5wb2dvc25hcFN0YXR1cyA9PT0gJ25vcmVzdWx0cycpIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwSGlkZGVuJScpLmpvaW4oJyBoaWRkZW4nKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwU3RhdHVzJScpLmpvaW4oJzxwPlBva2Vtb24gZG9lcyBub3QgaGF2ZSBhIHBpY3R1cmU8L3A+Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVsc2UgaWYgKHBva2Vtb24ucG9nb3NuYXBTdGF0dXMgPT09ICdsb2FkaW5nJykge1xyXG4gICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcEhpZGRlbiUnKS5qb2luKCcgaGlkZGVuJyk7XHJcbiAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwU3RhdHVzJScpLmpvaW4oJzxwPkxvYWRpbmcgcGljdHVyZS4uLjwvcD48YnI+JyArXHJcbiAgICAgICAnPGltZyBzcmM9XCJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL2QvZGUvQWpheC1sb2FkZXIuZ2lmXCIgXCJMb2FkaW5nIGljb25cIj4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcEhpZGRlbiUnKS5qb2luKCcgaGlkZGVuJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcFN0YXR1cyUnKS5qb2luKCc8cD5FcnJvciBsb2FkaW5nIHBpY3R1cmUgZnJvbSBSZWRkaXQ8L3A+Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKHBva2Vtb24ucG9rZWFwaVN0YXR1cyA9PT0gJ29rJykge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb2FwaUhpZGRlbiUnKS5qb2luKCcnKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2VhcGlTdGF0dXMlJykuam9pbignJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyV3ZWlnaHQlJykuam9pbihwb2tlbW9uLndlaWdodCAvIDEwKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWhlaWdodCUnKS5qb2luKHBva2Vtb24uaGVpZ2h0IC8gMTApO1xyXG4gICAgICAgIHZhciB0eXBlcyA9IHBva2Vtb24udHlwZXMuam9pbignLCAnKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXR5cGVzJScpLmpvaW4odHlwZXMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbHNlIGlmIChwb2tlbW9uLnBva2VhcGlTdGF0dXMgPT09ICdsb2FkaW5nJykge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZWFwaUhpZGRlbiUnKS5qb2luKCcgaGlkZGVuJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlYXBpU3RhdHVzJScpLmpvaW4oJzxwPkxvYWRpbmcgc3RhdHMuLi48L3A+PGJyPicgK1xyXG4gICAgICAgICc8aW1nIHNyYz1cImh0dHBzOi8vdXBsb2FkLndpa2ltZWRpYS5vcmcvd2lraXBlZGlhL2NvbW1vbnMvZC9kZS9BamF4LWxvYWRlci5naWZcIiBcIkxvYWRpbmcgaWNvblwiPicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2VhcGlIaWRkZW4lJykuam9pbignIGhpZGRlbicpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZWFwaVN0YXR1cyUnKS5qb2luKCc8cD5FcnJvciBsb2FkaW5nIHN0YXRzIGZyb20gUG9rZWFwaTwvcD4nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gR2VuZXJpYyBsb2NhdGlvbiBtYXJrZXIgdGVtcGxhdGUgaXRlbXM6XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29udGVudCA9IHRoaXMudGVtcGxhdGU7XHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclc3RyZWV0dmlldyUnKS5qb2luKGxvY2F0aW9uLnN0cmVldFZpZXdVcmwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRlbXBsYXRlIGl0ZW1zIGZvciBhbGwgbG9jYXRpb25zOlxyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVpZCUnKS5qb2luKGxvY2F0aW9uLmlkKTtcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCcldHlwZSUnKS5qb2luKGxvY2F0aW9uLnR5cGUpO1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVsYXQlJykuam9pbihsb2NhdGlvbi5sYXQpO1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVsbmclJykuam9pbihsb2NhdGlvbi5sbmcpO1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVuYW1lJScpLmpvaW4obG9jYXRpb24ubmFtZSk7XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWljb24lJykuam9pbihsb2NhdGlvbi5pY29uKTtcclxuXHJcbiAgICByZXR1cm4gY29udGVudDtcclxuICB9XHJcbn07XHJcbiIsInZhciBMaXN0Vmlld1ZpZXdNb2RlbCA9IGZ1bmN0aW9uICgpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5xdWVyeSA9IGtvLm9ic2VydmFibGUoJycpO1xyXG4gIHNlbGYubG9jYXRpb25zID0ga28ub2JzZXJ2YWJsZUFycmF5KCk7XHJcbiAgc2VsZi5maWx0ZXJlZExvY2F0aW9ucyA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBmaWx0ZXIgPSBzZWxmLnF1ZXJ5KCkudG9Mb3dlckNhc2UoKTtcclxuICAgIHZhciBmaWx0ZXJlZExvY2F0aW9ucyA9IFtdO1xyXG4gICAgLy8gc29ydCBzZWxmLmxvY2F0aW9uc1xyXG4gICAgc2VsZi5sb2NhdGlvbnMoKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgIHZhciBuYW1lQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICB2YXIgbmFtZUIgPSBiLm5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKGEubmFtZSA+IGIubmFtZSkge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChhLm5hbWUgPCBiLm5hbWUpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9KTtcclxuICAgIC8vIFJldHVybiBhbGwgbG9jYXRpb25zIGlmIGZpbHRlciBpcyBibGFua1xyXG4gICAgaWYgKGZpbHRlciA9PT0gJycpIHtcclxuICAgICAgLy8gTWFrZSBhbGwgbWFya2VycyB2aXNpYmxlXHJcbiAgICAgIG1vZGVsLm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAobWFya2VyKSB7XHJcbiAgICAgICAgbWFya2VyLnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc2VsZi5sb2NhdGlvbnMoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBIaWRlIGFsbCBtYXJrZXJzXHJcbiAgICAgIG1vZGVsLm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAobWFya2VyKSB7XHJcbiAgICAgICAgbWFya2VyLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgLy8gUHVzaCBsb2NhdGlvbiB0byBmaWx0ZXJlZExvY2F0aW9ucyBhbmRcclxuICAgICAgLy8gTWFrZSBtYXJrZXIgZm9yIGZpbHRlcmVkIGxvY2F0aW9uIHZpc2libGVcclxuICAgICAgc2VsZi5sb2NhdGlvbnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2MpIHtcclxuICAgICAgICB2YXIgbmFtZSA9IGxvYy5uYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIHR5cGUgPSBsb2MudHlwZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChuYW1lLnNlYXJjaChmaWx0ZXIpID4gLTEgfHwgdHlwZS5zZWFyY2goZmlsdGVyKSA+IC0xKSB7XHJcbiAgICAgICAgICBtb2RlbC5tYXJrZXJzW2xvYy5pZF0uc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgICAgICAgIGZpbHRlcmVkTG9jYXRpb25zLnB1c2gobG9jKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGxvYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZpbHRlcmVkTG9jYXRpb25zO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG52YXIgbGlzdFZpZXcgPSBuZXcgTGlzdFZpZXdWaWV3TW9kZWwoKTtcclxua28uYXBwbHlCaW5kaW5ncyhsaXN0Vmlldyk7XHJcblxyXG4vLyBIYW1idXJnZXIgTWVudSBTZXR1cFxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAkKCcuZHJhd2VyJykuZHJhd2VyKCk7XHJcbn0pO1xyXG4iLCJ2YXIgY29udHJvbGxlciA9IHtcclxuICBpbml0IDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi51cGRhdGVHeW1zKCk7XHJcbiAgICBzZWxmLnVwZGF0ZVNwYXducygpO1xyXG4gICAgc2VsZi51cGRhdGVQb2tlU3RvcHMoKTtcclxuICB9LFxyXG4gIHVwZGF0ZUd5bXMgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBmYi5vbkNoaWxkQWRkZWQoJ2d5bXMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICB2YXIgbG9jYXRpb25faWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgbmFtZSA9IGRhdGEudGl0bGU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG4gICAgICB2YXIgZ3ltID0gbmV3IExvY2F0aW9uIChsb2NhdGlvbl9pZCwgJ2d5bScsIGxhdCwgbG5nLCBuYW1lKTtcclxuICAgICAgTWFwVmlldy5jcmVhdGVNYXJrZXIoZ3ltKTtcclxuICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2goZ3ltKTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgdXBkYXRlUG9rZVN0b3BzIDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgZmIub25DaGlsZEFkZGVkKCdwb2tlc3RvcHMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICB2YXIgbG9jYXRpb25faWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgbmFtZSA9IGRhdGEudGl0bGU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG4gICAgICB2YXIgcG9rZXN0b3AgPSBuZXcgTG9jYXRpb24gKGxvY2F0aW9uX2lkLCAncG9rZXN0b3AnLCBsYXQsIGxuZywgbmFtZSk7XHJcbiAgICAgIE1hcFZpZXcuY3JlYXRlTWFya2VyKHBva2VzdG9wKTtcclxuICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2gocG9rZXN0b3ApO1xyXG4gICAgfSk7XHJcbiAgfSxcclxuICB1cGRhdGVTcGF3bnMgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBmYi5vbkNoaWxkQWRkZWQoJ3NwYXducycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsb2NfaWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgaWQgPSBkYXRhLnBva2Vtb25faWQ7XHJcbiAgICAgIHZhciBuYW1lID0gZGF0YS5wb2tlbW9uX25hbWU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG5cclxuICAgICAgbW9kZWwubG9jYXRpb25zW2xvY19pZF0gPSBuZXcgU3Bhd25Mb2NhdGlvbihsb2NfaWQsIGxhdCwgbG5nLCBpZCk7XG5cbiAgICAgIC8vIElmIG5ldyBwb2tlbW9uOlxuICAgICAgaWYgKG1vZGVsLnBva2Vtb25zW2lkXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHBva2Vtb24gd2l0aCBiYXJlIGluZm9cclxuICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0gPSBuZXcgUG9rZW1vbihpZCwgbmFtZSk7XHJcbiAgICAgICAgLy8gVXBkYXRlIGxvY2F0aW9uIG5hbWUgYW5kIGljb25cclxuICAgICAgICBtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXS51cGRhdGVQb2tlbW9uKG1vZGVsLnBva2Vtb25zW2lkXSk7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsb2NhdGlvbiBtYXJrZXJcclxuICAgICAgICBNYXBWaWV3LmNyZWF0ZU1hcmtlcihtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcbiAgICAgICAgLy8gUHVzaCBsb2NhdGlvbiB0byBsaXN0IHZpZXdcclxuICAgICAgICBsaXN0Vmlldy5sb2NhdGlvbnMucHVzaChtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gSWYgb2xkIHBva2Vtb246XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIFVwZGF0ZSBsb2NhdGlvbiBuYW1lIGFuZCBpY29uXHJcbiAgICAgICAgbW9kZWwubG9jYXRpb25zW2xvY19pZF0udXBkYXRlUG9rZW1vbihtb2RlbC5wb2tlbW9uc1tpZF0pO1xyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbG9jYXRpb24gbWFya2VyXHJcbiAgICAgICAgTWFwVmlldy5jcmVhdGVNYXJrZXIobW9kZWwubG9jYXRpb25zW2xvY19pZF0pO1xyXG4gICAgICAgIC8vIFB1c2ggbG9jYXRpb24gdG8gbGlzdCB2aWV3XHJcbiAgICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2gobW9kZWwubG9jYXRpb25zW2xvY19pZF0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVcGRhdGUgZGF0YSBmcm9tIHBvZ29zbmFwXHJcbiAgICAgIGlmIChtb2RlbC5wb2tlbW9uc1tpZF0ucG9nb1NuYXBTdGF0dXMgIT09ICdsb2FkaW5nJyAmJiAnb2snKSB7XHJcbiAgICAgICAgbW9kZWwucG9rZW1vbnNbaWRdLnBvZ29TbmFwU3RhdHVzID0gJ2xvYWRpbmcnO1xyXG4gICAgICAgIHBvZ29zbmFwLmdldERhdGEobW9kZWwucG9rZW1vbnNbaWRdLCBmdW5jdGlvbiAocGljRGF0YSkge1xyXG4gICAgICAgICAgbW9kZWwucG9rZW1vbnNbaWRdLnBpY3R1cmUgPSBwaWNEYXRhLnBpY3R1cmU7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucGVybWFsaW5rID0gcGljRGF0YS5wZXJtYWxpbms7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0uYXV0aG9yID0gcGljRGF0YS5hdXRob3I7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9nb3NuYXBTdGF0dXMgPSBwaWNEYXRhLnN0YXR1cztcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIGRhdGEgZnJvbSBwb2tlYXBpXHJcbiAgICAgIGlmIChtb2RlbC5wb2tlbW9uc1tpZF0ucG9rZWFwaVN0YXR1cyAhPT0gJ2xvYWRpbmcnICYmICdvaycpIHtcclxuICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9rZWFwaVN0YXR1cyA9ICdsb2FkaW5nJztcclxuICAgICAgICBwb2tlYXBpLmdldERhdGEoaWQsIGZ1bmN0aW9uIChiaW9EYXRhKSB7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ud2VpZ2h0ID0gYmlvRGF0YS53ZWlnaHQ7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0uaGVpZ2h0ID0gYmlvRGF0YS5oZWlnaHQ7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0udHlwZXMgPSBiaW9EYXRhLnR5cGVzO1xyXG4gICAgICAgICAgbW9kZWwucG9rZW1vbnNbaWRdLnBva2VhcGlTdGF0dXMgPSBiaW9EYXRhLnN0YXR1cztcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSxcclxufTtcclxuY29udHJvbGxlci5pbml0KCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
