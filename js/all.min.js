var fb={db:null,config:{apiKey:"AIzaSyD0LhmulK6Hrn-m-gfhj3XFNUq2OgfEmzg",authDomain:"pogo-63931.firebaseapp.com",databaseURL:"https://pogo-63931.firebaseio.com",storageBucket:"pogo-63931.appspot.com"},start:function(){firebase.initializeApp(this.config),this.db=firebase.database()},onChildAdded:function(t,a){var e=this.db.ref(t);e.on("child_added",function(t){var e=t.val();a(e)})}};fb.start();var pokeapi={urlPrefix:"https://pokeapi.co/api/v2/pokemon/",getData:function(t,a){var e=this.urlPrefix+t;$.getJSON(e,function(t){var e=[];t.types.forEach(function(t){e.push(t.type.name)});var i={weight:t.weight,height:t.height,types:e,status:"ok"};a(i)}).fail(function(){var t={weight:null,height:null,types:null,status:"fail"};a(t)})}},map,infoWindow,initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:19.725862,lng:-155.06906},zoom:16}),infoWindow=new google.maps.InfoWindow},googleError=function(){document.getElementById("map").innerHTML="<h1>Sorry, Google Maps is unavailable at the moment</h1><p>Please try again later.</p>"},pogosnap={urlPrefix:"https://www.reddit.com/r/PokemonGoSnap/search.json?",params:{restrict_sr:"true",limit:"1",sort:"top"},getData:function(t,a){var e=this,i=e.urlPrefix;i+="q="+t.name,i+="&restrict_sr="+e.params.restrict_sr,i+="&limit="+e.params.limit,i+="&sort="+e.params.sort;$.getJSON(i,function(t){var e=t.data.children[0].data;if(void 0!==e){var i={picture:pogosnap.fixUrl(e.preview.images[0].source.url),author:e.author,permalink:"https://www.reddit.com"+e.permalink,status:"ok"};a(i)}else{var r={picture:"#",author:"",permalink:"",status:"noresults"};a(r)}}).fail(function(){var t={picture:"#",author:"",permalink:"",status:"fail"};a(t)})},fixUrl:function(t){var a=t;return t.search("reddituploads")&&(a=t.split("&amp;").join("&")),t.search("imgur")&&t.search(".jpg")===-1&&(a+=".jpg"),a}};
var Pokemon=function(e,n){var i=this;i.id=e,i.name=n,i.icon="",i.types=[],i.weight="",i.height="",i.pokeapiStatus=null,i.picture="",i.author="",i.permalink="#",i.pogosnapStatus=null,i.setIcon=function(){var e="img/",n=".png",o=i.id.toString();i.id<10?o="00"+o:i.id<100&&(o="0"+o),i.icon=e+o+n},i.setIcon()},Location=function(e,n,i,o,t){var a=this;a.id=e,a.type=n,a.lat=i,a.lng=o,a.name=t,a.icon="img/"+n+".png",a.markerCreated=!1,a.streetViewUrl="",a.setStreetViewUrl=function(){var e="https://maps.googleapis.com/maps/api/streetview?",n={location:a.lat+","+a.lng,size:"300x200",key:"AIzaSyDnmyJXbQ5xflnzlvc1dJetLgJPbNerL-o"};e+="location="+n.location,e+="&size="+n.size,e+="&key="+n.key,a.streetViewUrl=e},a.openInfoWindow=function(){infoWindow.setContent(MapView.fillTemplate(a)),infoWindow.open(map,model.markers[a.id]),model.markers[a.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[a.id].setAnimation(null)},1420),$(".drawer").drawer("close")},a.setStreetViewUrl()},SpawnLocation=function(e,n,i,o){var t=this;t.id=e,t.type="spawn",t.lat=n,t.lng=i,t.name="",t.icon="",t.poke_id=o,t.openInfoWindow=function(){infoWindow.setContent(MapView.fillTemplate(t)),infoWindow.open(map,model.markers[t.id]),model.markers[t.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[t.id].setAnimation(null)},1420)},t.updatePokemon=function(e){t.poke_id=e.id,t.name=e.name,t.icon=e.icon}},model={pokemons:[],locations:[],markers:[]};
var MapView={createMarker:function(i){var o=this;void 0===model.markers[i.id]?(model.markers[i.id]=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:map,icon:i.icon,title:i.name,id:i.id}),model.markers[i.id].addListener("click",function(){infoWindow.setContent(o.fillTemplate(i)),infoWindow.open(map,model.markers[i.id]),model.markers[i.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[i.id].setAnimation(null)},1420)})):console.log("Marker already created for location:",i.name)},template:'<div id="loc-%id%"><h3>%name%</h3><p>(%lat%, %lng%)</p><p>Google Street View: </p><img src="%streetview%" alt="%name%"></div>',spawnTemplate:'<div id="loc-%id%"><h3>#%pokemon_id% %name%</h3><p>(%lat%, %lng%)</p>%pogosnapStatus%<div class="pic"%pogosnapHidden%><img src="%picture%" alt="%name%" style="width: 15em; height: 15em; object-fit: cover;"><p>Image Source: <a href="%permalink%">/r/PokemonGoSnap</a><br>Posted by: %author%</p></div>%pokeapiStatus%<div class="bio" %pokeapiHidden%><ul><li>Types: %types%</li><li>Weight: %weight% kg</li><li>Height: %height% m</li></ul></div></div>',fillTemplate:function(i){var o,e=model.pokemons[i.poke_id];if("spawn"===i.type)if(o=this.spawnTemplate,o=o.split("%pokemon_id%").join(i.poke_id),o=o.split("%picture%").join(e.picture),"ok"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(""),o=o.split("%pogosnapStatus%").join(""),o=o.split("%author%").join(e.author),o=o.split("%permalink%").join(e.permalink)):"noresults"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Pokemon does not have a picture</p>")):"loading"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join('<p>Loading picture...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Error loading picture from Reddit</p>")),"ok"===e.pokeapiStatus){o=o.split("%pogoapiHidden%").join(""),o=o.split("%pokeapiStatus%").join(""),o=o.split("%weight%").join(e.weight/10),o=o.split("%height%").join(e.height/10);var t=e.types.join(", ");o=o.split("%types%").join(t)}else"loading"===e.pokeapiStatus?(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join('<p>Loading stats...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join("<p>Error loading stats from Pokeapi</p>"));else o=this.template,o=o.split("%streetview%").join(i.streetViewUrl);return o=o.split("%id%").join(i.id),o=o.split("%type%").join(i.type),o=o.split("%lat%").join(i.lat),o=o.split("%lng%").join(i.lng),o=o.split("%name%").join(i.name),o=o.split("%icon%").join(i.icon)}};
var ListViewViewModel=function(){var e=this;e.query=ko.observable(""),e.locations=ko.observableArray(),e.filteredLocations=ko.computed(function(){var o=e.query().toLowerCase(),r=[];return e.locations().sort(function(e,o){e.name.toLowerCase(),o.name.toLowerCase();return e.name>o.name?1:e.name<o.name?-1:0}),""===o?(model.markers.forEach(function(e){e.setVisible(!0)}),e.locations()):(model.markers.forEach(function(e){e.setVisible(!1)}),e.locations().forEach(function(e){var a=e.name.toLowerCase(),i=e.type.toLowerCase();(a.search(o)>-1||i.search(o)>-1)&&(model.markers[e.id].setVisible(!0),r.push(e),console.log(e))}),r)})},listView=new ListViewViewModel;ko.applyBindings(listView),$(document).ready(function(){$(".drawer").drawer()});
var controller={init:function(){var o=this;o.updateGyms(),o.updateSpawns(),o.updatePokeStops()},updateGyms:function(){fb.onChildAdded("gyms",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"gym",n,a,t);MapView.createMarker(p),listView.locations.push(p)})},updatePokeStops:function(){fb.onChildAdded("pokestops",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"pokestop",n,a,t);MapView.createMarker(p),listView.locations.push(p)})},updateSpawns:function(){fb.onChildAdded("spawns",function(o){var e=o.id,t=o.pokemon_id,n=o.pokemon_name,a=o.lat,p=o.lng;model.locations[e]=new SpawnLocation(e,a,p,t),void 0===model.pokemons[t]?(model.pokemons[t]=new Pokemon(t,n),model.locations[e].updatePokemon(model.pokemons[t]),MapView.createMarker(model.locations[e]),listView.locations.push(model.locations[e])):(model.locations[e].updatePokemon(model.pokemons[t]),MapView.createMarker(model.locations[e]),listView.locations.push(model.locations[e])),"loading"!==model.pokemons[t].pogoSnapStatus&&(model.pokemons[t].pogoSnapStatus="loading",pogosnap.getData(model.pokemons[t],function(o){model.pokemons[t].picture=o.picture,model.pokemons[t].permalink=o.permalink,model.pokemons[t].author=o.author,model.pokemons[t].pogosnapStatus=o.status})),"loading"!==model.pokemons[t].pokeapiStatus&&(model.pokemons[t].pokeapiStatus="loading",pokeapi.getData(t,function(o){model.pokemons[t].weight=o.weight,model.pokemons[t].height=o.height,model.pokemons[t].types=o.types,model.pokemons[t].pokeapiStatus=o.status}))})}};controller.init();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwaXMuanMiLCJtb2RlbC5qcyIsInZpZXcuanMiLCJsaXN0dmlldy5qcyIsImNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiZmIiLCJkYiIsImNvbmZpZyIsImFwaUtleSIsImF1dGhEb21haW4iLCJkYXRhYmFzZVVSTCIsInN0b3JhZ2VCdWNrZXQiLCJzdGFydCIsImZpcmViYXNlIiwiaW5pdGlhbGl6ZUFwcCIsInRoaXMiLCJkYXRhYmFzZSIsIm9uQ2hpbGRBZGRlZCIsInJlZiIsImNiIiwibXlSZWYiLCJvbiIsInNuYXAiLCJkYXRhIiwidmFsIiwicG9rZWFwaSIsInVybFByZWZpeCIsImdldERhdGEiLCJpZCIsInVybCIsIiQiLCJnZXRKU09OIiwibXlUeXBlcyIsInR5cGVzIiwiZm9yRWFjaCIsInR5cGUiLCJwdXNoIiwibmFtZSIsIm15RGF0YSIsIndlaWdodCIsImhlaWdodCIsInN0YXR1cyIsImZhaWwiLCJub0RhdGEiLCJtYXAiLCJpbmZvV2luZG93IiwiaW5pdE1hcCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2VudGVyIiwibGF0IiwibG5nIiwiem9vbSIsIkluZm9XaW5kb3ciLCJnb29nbGVFcnJvciIsImlubmVySFRNTCIsInBvZ29zbmFwIiwicGFyYW1zIiwicmVzdHJpY3Rfc3IiLCJsaW1pdCIsInNvcnQiLCJwb2tlbW9uIiwic2VsZiIsImxpc3RpbmciLCJjaGlsZHJlbiIsInVuZGVmaW5lZCIsInBpY3R1cmUiLCJmaXhVcmwiLCJwcmV2aWV3IiwiaW1hZ2VzIiwic291cmNlIiwiYXV0aG9yIiwicGVybWFsaW5rIiwibmV3VXJsIiwic2VhcmNoIiwic3BsaXQiLCJqb2luIiwiUG9rZW1vbiIsImljb24iLCJwb2tlYXBpU3RhdHVzIiwicG9nb3NuYXBTdGF0dXMiLCJzZXRJY29uIiwibG9jYXRpb24iLCJ0aHJlZURpZ2l0SWQiLCJ0b1N0cmluZyIsIkxvY2F0aW9uIiwibWFya2VyQ3JlYXRlZCIsInN0cmVldFZpZXdVcmwiLCJzZXRTdHJlZXRWaWV3VXJsIiwic2l6ZSIsImtleSIsIm9wZW5JbmZvV2luZG93Iiwic2V0Q29udGVudCIsIk1hcFZpZXciLCJmaWxsVGVtcGxhdGUiLCJvcGVuIiwibW9kZWwiLCJtYXJrZXJzIiwic2V0QW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiQk9VTkNFIiwic2V0VGltZW91dCIsImRyYXdlciIsIlNwYXduTG9jYXRpb24iLCJwb2tlX2lkIiwidXBkYXRlUG9rZW1vbiIsInBva2Vtb25zIiwibG9jYXRpb25zIiwiY3JlYXRlTWFya2VyIiwiTWFya2VyIiwicG9zaXRpb24iLCJ0aXRsZSIsImFkZExpc3RlbmVyIiwiY29uc29sZSIsImxvZyIsInRlbXBsYXRlIiwic3Bhd25UZW1wbGF0ZSIsImNvbnRlbnQiLCJMaXN0Vmlld1ZpZXdNb2RlbCIsInF1ZXJ5Iiwia28iLCJvYnNlcnZhYmxlIiwib2JzZXJ2YWJsZUFycmF5IiwiZmlsdGVyZWRMb2NhdGlvbnMiLCJjb21wdXRlZCIsImZpbHRlciIsInRvTG93ZXJDYXNlIiwiYSIsImIiLCJtYXJrZXIiLCJzZXRWaXNpYmxlIiwibG9jIiwibGlzdFZpZXciLCJhcHBseUJpbmRpbmdzIiwicmVhZHkiLCJjb250cm9sbGVyIiwiaW5pdCIsInVwZGF0ZUd5bXMiLCJ1cGRhdGVTcGF3bnMiLCJ1cGRhdGVQb2tlU3RvcHMiLCJsb2NhdGlvbl9pZCIsImd5bSIsInBva2VzdG9wIiwibG9jX2lkIiwicG9rZW1vbl9pZCIsInBva2Vtb25fbmFtZSIsInBvZ29TbmFwU3RhdHVzIiwicGljRGF0YSIsImJpb0RhdGEiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLEtBQ0ZDLEdBQUssS0FDTEMsUUFDRUMsT0FBUSwwQ0FDUkMsV0FBWSw2QkFDWkMsWUFBYSxvQ0FDYkMsY0FBZSwwQkFFakJDLE1BQVEsV0FDTkMsU0FBU0MsY0FBY0MsS0FBS1IsUUFDNUJRLEtBQUtULEdBQUtPLFNBQVNHLFlBRXJCQyxhQUFlLFNBQVVDLEVBQUtD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LFFBQ3JDOEIsTUFBTVUsU0FBU2pGLEdBQUkrQyxVQUFZMkUsRUFBUTNFLFVBQ3ZDd0IsTUFBTVUsU0FBU2pGLEdBQUk4QyxPQUFTNEUsRUFBUTVFLE9BQ3BDeUIsTUFBTVUsU0FBU2pGLEdBQUl1RCxlQUFpQm1FLEVBQVE3RyxVQUtQLFlBQXJDMEQsTUFBTVUsU0FBU2pGLEdBQUlzRCxnQkFDckJpQixNQUFNVSxTQUFTakYsR0FBSXNELGNBQWdCLFVBQ25DekQsUUFBUUUsUUFBUUMsRUFBSSxTQUFVMkgsR0FDNUJwRCxNQUFNVSxTQUFTakYsR0FBSVcsT0FBU2dILEVBQVFoSCxPQUNwQzRELE1BQU1VLFNBQVNqRixHQUFJWSxPQUFTK0csRUFBUS9HLE9BQ3BDMkQsTUFBTVUsU0FBU2pGLEdBQUlLLE1BQVFzSCxFQUFRdEgsTUFDbkNrRSxNQUFNVSxTQUFTakYsR0FBSXNELGNBQWdCcUUsRUFBUTlHLGFBTXJEaUcsWUFBV0MiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpcmViYXNlXHJcbnZhciBmYiA9IHtcclxuICBkYiA6IG51bGwsXHJcbiAgY29uZmlnIDoge1xyXG4gICAgYXBpS2V5OiBcIkFJemFTeUQwTGhtdWxLNkhybi1tLWdmaGozWEZOVXEyT2dmRW16Z1wiLFxyXG4gICAgYXV0aERvbWFpbjogXCJwb2dvLTYzOTMxLmZpcmViYXNlYXBwLmNvbVwiLFxyXG4gICAgZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly9wb2dvLTYzOTMxLmZpcmViYXNlaW8uY29tXCIsXHJcbiAgICBzdG9yYWdlQnVja2V0OiBcInBvZ28tNjM5MzEuYXBwc3BvdC5jb21cIixcclxuICB9LFxyXG4gIHN0YXJ0IDogZnVuY3Rpb24gKCkge1xyXG4gICAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcCh0aGlzLmNvbmZpZyk7XHJcbiAgICB0aGlzLmRiID0gZmlyZWJhc2UuZGF0YWJhc2UoKTtcclxuICB9LFxyXG4gIG9uQ2hpbGRBZGRlZCA6IGZ1bmN0aW9uIChyZWYsIGNiKSB7XHJcbiAgICB2YXIgbXlSZWYgPSB0aGlzLmRiLnJlZihyZWYpO1xyXG4gICAgbXlSZWYub24oJ2NoaWxkX2FkZGVkJywgZnVuY3Rpb24gKHNuYXApIHtcclxuICAgICAgdmFyIGRhdGEgPSBzbmFwLnZhbCgpO1xyXG4gICAgICBjYihkYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxufTtcclxuZmIuc3RhcnQoKTtcclxuLy8gUG9rZWFwaVxyXG52YXIgcG9rZWFwaSA9IHtcclxuICB1cmxQcmVmaXggOiAnaHR0cHM6Ly9wb2tlYXBpLmNvL2FwaS92Mi9wb2tlbW9uLycsXHJcbiAgZ2V0RGF0YSA6IGZ1bmN0aW9uIChpZCwgY2IpIHtcclxuICAgIHZhciB1cmwgPSB0aGlzLnVybFByZWZpeCArIGlkO1xyXG4gICAgdmFyIGpxeGhyID0gJC5nZXRKU09OKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgdmFyIG15VHlwZXMgPSBbXTtcclxuICAgICAgZGF0YS50eXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgbXlUeXBlcy5wdXNoKHR5cGUudHlwZS5uYW1lKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHZhciBteURhdGEgPSB7XHJcbiAgICAgICAgd2VpZ2h0OiBkYXRhLndlaWdodCxcclxuICAgICAgICBoZWlnaHQ6IGRhdGEuaGVpZ2h0LFxyXG4gICAgICAgIHR5cGVzOiBteVR5cGVzLFxyXG4gICAgICAgIHN0YXR1czogJ29rJyxcclxuICAgICAgfTtcclxuICAgICAgY2IobXlEYXRhKTtcclxuICAgIH0pXHJcbiAgICAuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHZhciBub0RhdGEgPSB7XHJcbiAgICAgICAgd2VpZ2h0OiBudWxsLFxyXG4gICAgICAgIGhlaWdodDogbnVsbCxcclxuICAgICAgICB0eXBlczogbnVsbCxcclxuICAgICAgICBzdGF0dXM6ICdmYWlsJ1xyXG4gICAgICB9O1xyXG4gICAgICBjYihub0RhdGEpO1xyXG4gICAgfSk7XHJcbiAgfSxcclxufTtcclxuLy8gR29vZ2xlIE1hcHNcclxudmFyIG1hcCwgaW5mb1dpbmRvdztcclxudmFyIGluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIGNlbnRlcjoge2xhdDogMTkuNzI1ODYyLCBsbmc6IC0xNTUuMDY5MDZ9LFxyXG4gICAgem9vbTogMTZcclxuICB9KTtcclxuICBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcclxufTtcclxudmFyIGdvb2dsZUVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKS5pbm5lckhUTUwgPSAnPGgxPlNvcnJ5LCBHb29nbGUgTWFwcyBpcyB1bmF2YWlsYWJsZSBhdCB0aGUgbW9tZW50PC9oMT48cD5QbGVhc2UgdHJ5IGFnYWluIGxhdGVyLjwvcD4nO1xyXG59O1xyXG4vLyBSZWRkaXQgL3IvUG9rZW1vbkdvU25hcFxyXG52YXIgcG9nb3NuYXAgPSB7XHJcbiAgdXJsUHJlZml4IDogJ2h0dHBzOi8vd3d3LnJlZGRpdC5jb20vci9Qb2tlbW9uR29TbmFwL3NlYXJjaC5qc29uPycsXHJcbiAgcGFyYW1zIDoge1xyXG4gICAgcmVzdHJpY3Rfc3IgOiAndHJ1ZScsXHJcbiAgICBsaW1pdCA6ICcxJyxcclxuICAgIHNvcnQgOiAndG9wJ1xyXG4gIH0sXHJcbiAgZ2V0RGF0YSA6IGZ1bmN0aW9uIChwb2tlbW9uLCBjYikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIHVybCA9IHNlbGYudXJsUHJlZml4O1xyXG4gICAgdXJsICs9ICdxPScgKyBwb2tlbW9uLm5hbWU7XHJcbiAgICB1cmwgKz0gJyZyZXN0cmljdF9zcj0nICsgc2VsZi5wYXJhbXMucmVzdHJpY3Rfc3I7XHJcbiAgICB1cmwgKz0gJyZsaW1pdD0nICsgc2VsZi5wYXJhbXMubGltaXQ7XHJcbiAgICB1cmwgKz0gJyZzb3J0PScgKyBzZWxmLnBhcmFtcy5zb3J0O1xyXG5cclxuICAgIHZhciBqcXhociA9ICQuZ2V0SlNPTih1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsaXN0aW5nID0gZGF0YS5kYXRhLmNoaWxkcmVuWzBdLmRhdGE7XHJcbiAgICAgIGlmIChsaXN0aW5nICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YXIgbXlEYXRhID0ge1xyXG4gICAgICAgICAgcGljdHVyZTogcG9nb3NuYXAuZml4VXJsKGxpc3RpbmcucHJldmlldy5pbWFnZXNbMF0uc291cmNlLnVybCksXHJcbiAgICAgICAgICBhdXRob3I6IGxpc3RpbmcuYXV0aG9yLFxyXG4gICAgICAgICAgcGVybWFsaW5rOiAnaHR0cHM6Ly93d3cucmVkZGl0LmNvbScgKyBsaXN0aW5nLnBlcm1hbGluayxcclxuICAgICAgICAgIHN0YXR1czogJ29rJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY2IobXlEYXRhKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB2YXIgbm9EYXRhID0ge1xyXG4gICAgICAgICAgcGljdHVyZTogJyMnLFxyXG4gICAgICAgICAgYXV0aG9yOiAnJyxcclxuICAgICAgICAgIHBlcm1hbGluazogJycsXHJcbiAgICAgICAgICBzdGF0dXM6ICdub3Jlc3VsdHMnXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjYihub0RhdGEpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgbm9EYXRhID0ge1xyXG4gICAgICAgIHBpY3R1cmU6ICcjJyxcclxuICAgICAgICBhdXRob3I6ICcnLFxyXG4gICAgICAgIHBlcm1hbGluazogJycsXHJcbiAgICAgICAgc3RhdHVzOiAnZmFpbCdcclxuICAgICAgfTtcclxuICAgICAgY2Iobm9EYXRhKTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgZml4VXJsIDogZnVuY3Rpb24gKHVybCkge1xyXG4gICAgdmFyIG5ld1VybCA9IHVybDtcclxuICAgIGlmICh1cmwuc2VhcmNoKCdyZWRkaXR1cGxvYWRzJykpIHtcclxuICAgICAgbmV3VXJsID0gdXJsLnNwbGl0KCcmYW1wOycpLmpvaW4oJyYnKTtcclxuICAgIH1cclxuICAgIGlmICh1cmwuc2VhcmNoKCdpbWd1cicpICYmIHVybC5zZWFyY2goJy5qcGcnKSA9PT0gLTEpIHtcclxuICAgICAgbmV3VXJsICs9ICcuanBnJztcclxuICAgIH1cclxuICAgIHJldHVybiBuZXdVcmw7XHJcbiAgfSxcclxufTtcclxuIiwiLy8gUG9rZW1vbiBDbGFzc1xyXG52YXIgUG9rZW1vbiA9IGZ1bmN0aW9uIChpZCwgbmFtZSkge1xyXG4gIHZhciBzZWxmID0gdGhpcztcclxuICBzZWxmLmlkID0gaWQ7XHJcbiAgc2VsZi5uYW1lID0gbmFtZTtcclxuICBzZWxmLmljb24gPSAnJztcclxuICAvLyBVcGRhdGVkIGZyb20gUG9rZWFwaTpcclxuICBzZWxmLnR5cGVzID0gW107XHJcbiAgc2VsZi53ZWlnaHQgPSAnJztcclxuICBzZWxmLmhlaWdodCA9ICcnO1xyXG4gIHNlbGYucG9rZWFwaVN0YXR1cyA9IG51bGw7XHJcbiAgLy8gVXBkYXRlZCBmcm9tIC9yL1Bva2Vtb25Hb1NuYXA6XHJcbiAgc2VsZi5waWN0dXJlID0gJyc7XHJcbiAgc2VsZi5hdXRob3IgPSAnJztcclxuICBzZWxmLnBlcm1hbGluayA9ICcjJztcclxuICBzZWxmLnBvZ29zbmFwU3RhdHVzID0gbnVsbDtcclxuXHJcbiAgc2VsZi5zZXRJY29uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGxvY2F0aW9uID0gJ2ltZy8nO1xyXG4gICAgdmFyIHR5cGUgPSAnLnBuZyc7XHJcbiAgICB2YXIgdGhyZWVEaWdpdElkID0gc2VsZi5pZC50b1N0cmluZygpO1xyXG4gICAgaWYgKHNlbGYuaWQgPCAxMCkge1xyXG4gICAgICB0aHJlZURpZ2l0SWQgPSAnMDAnICsgdGhyZWVEaWdpdElkO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoc2VsZi5pZCA8IDEwMCkge1xyXG4gICAgICB0aHJlZURpZ2l0SWQgPSAnMCcgKyB0aHJlZURpZ2l0SWQ7XHJcbiAgICB9XHJcbiAgICBzZWxmLmljb24gPSBsb2NhdGlvbiArIHRocmVlRGlnaXRJZCArIHR5cGU7XHJcbiAgfTtcclxuICBzZWxmLnNldEljb24oKTtcclxufTtcclxuLy8gTG9jYXRpb24gQ2xhc3NcclxudmFyIExvY2F0aW9uID0gZnVuY3Rpb24gKGlkLCB0eXBlLCBsYXQsIGxuZywgbmFtZSkge1xyXG4gIHZhciBzZWxmID0gdGhpcztcclxuICBzZWxmLmlkID0gaWQ7XHJcbiAgc2VsZi50eXBlID0gdHlwZTsgLy8gZ3ltLCBwb2tlc3RvcFxyXG4gIHNlbGYubGF0ID0gbGF0O1xyXG4gIHNlbGYubG5nID0gbG5nO1xyXG4gIHNlbGYubmFtZSA9IG5hbWU7XHJcbiAgc2VsZi5pY29uID0gJ2ltZy8nICsgdHlwZSArICcucG5nJztcclxuICBzZWxmLm1hcmtlckNyZWF0ZWQgPSBmYWxzZTtcclxuICBzZWxmLnN0cmVldFZpZXdVcmwgPSAnJztcclxuICBzZWxmLnNldFN0cmVldFZpZXdVcmwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgdXJsID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9zdHJlZXR2aWV3Pyc7XHJcbiAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICBsb2NhdGlvbiA6IHNlbGYubGF0ICsgJywnICsgc2VsZi5sbmcsXHJcbiAgICAgIHNpemUgOiAnMzAweDIwMCcsXHJcbiAgICAgIGtleSA6ICdBSXphU3lEbm15SlhiUTV4Zmxuemx2YzFkSmV0TGdKUGJOZXJMLW8nXHJcbiAgICB9O1xyXG4gICAgdXJsICs9ICdsb2NhdGlvbj0nICsgcGFyYW1zLmxvY2F0aW9uO1xyXG4gICAgdXJsICs9ICcmc2l6ZT0nICsgcGFyYW1zLnNpemU7XHJcbiAgICB1cmwgKz0gJyZrZXk9JyArIHBhcmFtcy5rZXk7XHJcbiAgICBzZWxmLnN0cmVldFZpZXdVcmwgPSB1cmw7XHJcbiAgfTtcclxuICBzZWxmLm9wZW5JbmZvV2luZG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KE1hcFZpZXcuZmlsbFRlbXBsYXRlKHNlbGYpKTtcclxuICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1vZGVsLm1hcmtlcnNbc2VsZi5pZF0pO1xyXG4gICAgLy8gQm91bmNlIHR3aWNlIG9uIGNsaWNrXHJcbiAgICBtb2RlbC5tYXJrZXJzW3NlbGYuaWRdLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICBtb2RlbC5tYXJrZXJzW3NlbGYuaWRdLnNldEFuaW1hdGlvbihudWxsKTtcclxuICAgIH0sIDE0MjApO1xyXG4gICAgJCgnLmRyYXdlcicpLmRyYXdlcignY2xvc2UnKTtcclxuICB9O1xyXG4gIHNlbGYuc2V0U3RyZWV0Vmlld1VybCgpO1xyXG59O1xyXG4vLyBTcGF3biBMb2NhdGlvbiBDbGFzc1xyXG52YXIgU3Bhd25Mb2NhdGlvbiA9IGZ1bmN0aW9uIChpZCwgbGF0LCBsbmcsIHBva2VfaWQpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5pZCA9IGlkO1xyXG4gIHNlbGYudHlwZSA9ICdzcGF3bic7XHJcbiAgc2VsZi5sYXQgPSBsYXQ7XHJcbiAgc2VsZi5sbmcgPSBsbmc7XHJcbiAgc2VsZi5uYW1lID0gJyc7XHJcbiAgc2VsZi5pY29uID0gJyc7XHJcbiAgc2VsZi5wb2tlX2lkID0gcG9rZV9pZDtcclxuICBzZWxmLm9wZW5JbmZvV2luZG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KE1hcFZpZXcuZmlsbFRlbXBsYXRlKHNlbGYpKTtcclxuICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1vZGVsLm1hcmtlcnNbc2VsZi5pZF0pO1xyXG4gICAgbW9kZWwubWFya2Vyc1tzZWxmLmlkXS5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgbW9kZWwubWFya2Vyc1tzZWxmLmlkXS5zZXRBbmltYXRpb24obnVsbCk7XHJcbiAgICB9LCAxNDIwKTtcclxuICB9O1xyXG4gIHNlbGYudXBkYXRlUG9rZW1vbiA9IGZ1bmN0aW9uIChwb2tlbW9uKSB7XHJcbiAgICBzZWxmLnBva2VfaWQgPSBwb2tlbW9uLmlkO1xyXG4gICAgc2VsZi5uYW1lID0gcG9rZW1vbi5uYW1lO1xyXG4gICAgc2VsZi5pY29uID0gcG9rZW1vbi5pY29uO1xyXG4gIH07XHJcbn07XHJcblxyXG52YXIgbW9kZWwgPSB7XHJcbiAgcG9rZW1vbnMgOiBbXSxcclxuICBsb2NhdGlvbnMgOiBbXSxcclxuICBtYXJrZXJzIDogW10sXHJcbn07XHJcbiIsInZhciBNYXBWaWV3ID0ge1xyXG4gIGNyZWF0ZU1hcmtlciA6IGZ1bmN0aW9uIChsb2NhdGlvbikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0gPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjoge2xhdDogbG9jYXRpb24ubGF0LCBsbmc6IGxvY2F0aW9uLmxuZ30sXHJcbiAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgaWNvbjogbG9jYXRpb24uaWNvbixcclxuICAgICAgICB0aXRsZTogbG9jYXRpb24ubmFtZSxcclxuICAgICAgICBpZDogbG9jYXRpb24uaWRcclxuICAgICAgfSk7XHJcbiAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBPcGVuIGluZm93aW5kb3dcclxuICAgICAgICBpbmZvV2luZG93LnNldENvbnRlbnQoc2VsZi5maWxsVGVtcGxhdGUobG9jYXRpb24pKTtcclxuICAgICAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtb2RlbC5tYXJrZXJzW2xvY2F0aW9uLmlkXSk7XHJcbiAgICAgICAgLy8gQm91bmNlIHR3aWNlIG9uIGNsaWNrXHJcbiAgICAgICAgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0uc2V0QW5pbWF0aW9uKGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5CT1VOQ0UpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0uc2V0QW5pbWF0aW9uKG51bGwpO1xyXG4gICAgICAgIH0sIDE0MjApO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygnTWFya2VyIGFscmVhZHkgY3JlYXRlZCBmb3IgbG9jYXRpb246JywgbG9jYXRpb24ubmFtZSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB0ZW1wbGF0ZSA6XHJcblxyXG4gICc8ZGl2IGlkPVwibG9jLSVpZCVcIj4nICtcclxuICAgICc8aDM+JW5hbWUlPC9oMz4nICtcclxuICAgICc8cD4oJWxhdCUsICVsbmclKTwvcD4nICtcclxuICAgICc8cD5Hb29nbGUgU3RyZWV0IFZpZXc6IDwvcD4nICtcclxuICAgICc8aW1nIHNyYz1cIiVzdHJlZXR2aWV3JVwiIGFsdD1cIiVuYW1lJVwiPicgK1xyXG4gICc8L2Rpdj4nLFxyXG5cclxuICBzcGF3blRlbXBsYXRlIDpcclxuXHJcbiAgJzxkaXYgaWQ9XCJsb2MtJWlkJVwiPicgK1xyXG4gICAgJzxoMz4jJXBva2Vtb25faWQlICVuYW1lJTwvaDM+JyArXHJcbiAgICAnPHA+KCVsYXQlLCAlbG5nJSk8L3A+JyArXHJcbiAgICAnJXBvZ29zbmFwU3RhdHVzJScgK1xyXG4gICAgJzxkaXYgY2xhc3M9XCJwaWNcIiVwb2dvc25hcEhpZGRlbiU+JyArXHJcbiAgICAgICc8aW1nIHNyYz1cIiVwaWN0dXJlJVwiIGFsdD1cIiVuYW1lJVwiIHN0eWxlPVwid2lkdGg6IDE1ZW07IGhlaWdodDogMTVlbTsgb2JqZWN0LWZpdDogY292ZXI7XCI+JyArXHJcbiAgICAgICc8cD4nICtcclxuICAgICAgICAnSW1hZ2UgU291cmNlOiA8YSBocmVmPVwiJXBlcm1hbGluayVcIj4vci9Qb2tlbW9uR29TbmFwPC9hPjxicj4nICtcclxuICAgICAgICAnUG9zdGVkIGJ5OiAlYXV0aG9yJScgK1xyXG4gICAgICAnPC9wPicgK1xyXG4gICAgJzwvZGl2PicgK1xyXG4gICAgJyVwb2tlYXBpU3RhdHVzJScgK1xyXG4gICAgJzxkaXYgY2xhc3M9XCJiaW9cIiAlcG9rZWFwaUhpZGRlbiU+JyArXHJcbiAgICAgICc8dWw+JyArXHJcbiAgICAgICAgJzxsaT5UeXBlczogJXR5cGVzJTwvbGk+JyArXHJcbiAgICAgICAgJzxsaT5XZWlnaHQ6ICV3ZWlnaHQlIGtnPC9saT4nICtcclxuICAgICAgICAnPGxpPkhlaWdodDogJWhlaWdodCUgbTwvbGk+JyArXHJcbiAgICAgICc8L3VsPicgK1xyXG4gICAgJzwvZGl2PicrXHJcbiAgJzwvZGl2PicsXHJcblxyXG4gIGZpbGxUZW1wbGF0ZSA6IGZ1bmN0aW9uIChsb2NhdGlvbikge1xyXG4gICAgdmFyIGNvbnRlbnQ7XHJcbiAgICB2YXIgcG9rZW1vbiA9IG1vZGVsLnBva2Vtb25zW2xvY2F0aW9uLnBva2VfaWRdO1xyXG5cclxuICAgIC8vIFBva2Vtb24gc3BlY2lmaWMgdGVtcGxhdGUgaXRlbXM6XHJcbiAgICBpZiAobG9jYXRpb24udHlwZSA9PT0gJ3NwYXduJykge1xyXG4gICAgICBjb250ZW50ID0gdGhpcy5zcGF3blRlbXBsYXRlO1xyXG4gICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2Vtb25faWQlJykuam9pbihsb2NhdGlvbi5wb2tlX2lkKTtcclxuICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwaWN0dXJlJScpLmpvaW4ocG9rZW1vbi5waWN0dXJlKTtcclxuXHJcbiAgICAgIGlmIChwb2tlbW9uLnBvZ29zbmFwU3RhdHVzID09PSAnb2snKSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcEhpZGRlbiUnKS5qb2luKCcnKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwU3RhdHVzJScpLmpvaW4oJycpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclYXV0aG9yJScpLmpvaW4ocG9rZW1vbi5hdXRob3IpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcGVybWFsaW5rJScpLmpvaW4ocG9rZW1vbi5wZXJtYWxpbmspO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbHNlIGlmIChwb2tlbW9uLnBvZ29zbmFwU3RhdHVzID09PSAnbm9yZXN1bHRzJykge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBIaWRkZW4lJykuam9pbignIGhpZGRlbicpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBTdGF0dXMlJykuam9pbignPHA+UG9rZW1vbiBkb2VzIG5vdCBoYXZlIGEgcGljdHVyZTwvcD4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSBpZiAocG9rZW1vbi5wb2dvc25hcFN0YXR1cyA9PT0gJ2xvYWRpbmcnKSB7XHJcbiAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwSGlkZGVuJScpLmpvaW4oJyBoaWRkZW4nKTtcclxuICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBTdGF0dXMlJykuam9pbignPHA+TG9hZGluZyBwaWN0dXJlLi4uPC9wPjxicj4nICtcclxuICAgICAgICc8aW1nIHNyYz1cImh0dHBzOi8vdXBsb2FkLndpa2ltZWRpYS5vcmcvd2lraXBlZGlhL2NvbW1vbnMvZC9kZS9BamF4LWxvYWRlci5naWZcIiBcIkxvYWRpbmcgaWNvblwiPicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwSGlkZGVuJScpLmpvaW4oJyBoaWRkZW4nKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwU3RhdHVzJScpLmpvaW4oJzxwPkVycm9yIGxvYWRpbmcgcGljdHVyZSBmcm9tIFJlZGRpdDwvcD4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYocG9rZW1vbi5wb2tlYXBpU3RhdHVzID09PSAnb2snKSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvYXBpSGlkZGVuJScpLmpvaW4oJycpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZWFwaVN0YXR1cyUnKS5qb2luKCcnKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXdlaWdodCUnKS5qb2luKHBva2Vtb24ud2VpZ2h0IC8gMTApO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclaGVpZ2h0JScpLmpvaW4ocG9rZW1vbi5oZWlnaHQgLyAxMCk7XHJcbiAgICAgICAgdmFyIHR5cGVzID0gcG9rZW1vbi50eXBlcy5qb2luKCcsICcpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCcldHlwZXMlJykuam9pbih0eXBlcyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVsc2UgaWYgKHBva2Vtb24ucG9rZWFwaVN0YXR1cyA9PT0gJ2xvYWRpbmcnKSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlYXBpSGlkZGVuJScpLmpvaW4oJyBoaWRkZW4nKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2VhcGlTdGF0dXMlJykuam9pbignPHA+TG9hZGluZyBzdGF0cy4uLjwvcD48YnI+JyArXHJcbiAgICAgICAgJzxpbWcgc3JjPVwiaHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy9kL2RlL0FqYXgtbG9hZGVyLmdpZlwiIFwiTG9hZGluZyBpY29uXCI+Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZWFwaUhpZGRlbiUnKS5qb2luKCcgaGlkZGVuJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlYXBpU3RhdHVzJScpLmpvaW4oJzxwPkVycm9yIGxvYWRpbmcgc3RhdHMgZnJvbSBQb2tlYXBpPC9wPicpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBHZW5lcmljIGxvY2F0aW9uIG1hcmtlciB0ZW1wbGF0ZSBpdGVtczpcclxuICAgIGVsc2Uge1xyXG4gICAgICBjb250ZW50ID0gdGhpcy50ZW1wbGF0ZTtcclxuICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVzdHJlZXR2aWV3JScpLmpvaW4obG9jYXRpb24uc3RyZWV0Vmlld1VybCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGVtcGxhdGUgaXRlbXMgZm9yIGFsbCBsb2NhdGlvbnM6XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWlkJScpLmpvaW4obG9jYXRpb24uaWQpO1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyV0eXBlJScpLmpvaW4obG9jYXRpb24udHlwZSk7XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWxhdCUnKS5qb2luKGxvY2F0aW9uLmxhdCk7XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJWxuZyUnKS5qb2luKGxvY2F0aW9uLmxuZyk7XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJW5hbWUlJykuam9pbihsb2NhdGlvbi5uYW1lKTtcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclaWNvbiUnKS5qb2luKGxvY2F0aW9uLmljb24pO1xyXG5cclxuICAgIHJldHVybiBjb250ZW50O1xyXG4gIH1cclxufTtcclxuIiwidmFyIExpc3RWaWV3Vmlld01vZGVsID0gZnVuY3Rpb24gKCkge1xyXG4gIHZhciBzZWxmID0gdGhpcztcclxuICBzZWxmLnF1ZXJ5ID0ga28ub2JzZXJ2YWJsZSgnJyk7XHJcbiAgc2VsZi5sb2NhdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcclxuICBzZWxmLmZpbHRlcmVkTG9jYXRpb25zID0ga28uY29tcHV0ZWQoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGZpbHRlciA9IHNlbGYucXVlcnkoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgdmFyIGZpbHRlcmVkTG9jYXRpb25zID0gW107XHJcbiAgICAvLyBzb3J0IHNlbGYubG9jYXRpb25zXHJcbiAgICBzZWxmLmxvY2F0aW9ucygpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgdmFyIG5hbWVBID0gYS5uYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIHZhciBuYW1lQiA9IGIubmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAoYS5uYW1lID4gYi5uYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGEubmFtZSA8IGIubmFtZSkge1xyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH0pO1xyXG4gICAgLy8gUmV0dXJuIGFsbCBsb2NhdGlvbnMgaWYgZmlsdGVyIGlzIGJsYW5rXHJcbiAgICBpZiAoZmlsdGVyID09PSAnJykge1xyXG4gICAgICAvLyBNYWtlIGFsbCBtYXJrZXJzIHZpc2libGVcclxuICAgICAgbW9kZWwubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChtYXJrZXIpIHtcclxuICAgICAgICBtYXJrZXIuc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBzZWxmLmxvY2F0aW9ucygpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIEhpZGUgYWxsIG1hcmtlcnNcclxuICAgICAgbW9kZWwubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChtYXJrZXIpIHtcclxuICAgICAgICBtYXJrZXIuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyBQdXNoIGxvY2F0aW9uIHRvIGZpbHRlcmVkTG9jYXRpb25zIGFuZFxyXG4gICAgICAvLyBNYWtlIG1hcmtlciBmb3IgZmlsdGVyZWQgbG9jYXRpb24gdmlzaWJsZVxyXG4gICAgICBzZWxmLmxvY2F0aW9ucygpLmZvckVhY2goZnVuY3Rpb24gKGxvYykge1xyXG4gICAgICAgIHZhciBuYW1lID0gbG9jLm5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB2YXIgdHlwZSA9IGxvYy50eXBlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKG5hbWUuc2VhcmNoKGZpbHRlcikgPiAtMSB8fCB0eXBlLnNlYXJjaChmaWx0ZXIpID4gLTEpIHtcclxuICAgICAgICAgIG1vZGVsLm1hcmtlcnNbbG9jLmlkXS5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICAgICAgICAgZmlsdGVyZWRMb2NhdGlvbnMucHVzaChsb2MpO1xyXG4gICAgICAgICAgY29uc29sZS5sb2cobG9jKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZmlsdGVyZWRMb2NhdGlvbnM7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcbnZhciBsaXN0VmlldyA9IG5ldyBMaXN0Vmlld1ZpZXdNb2RlbCgpO1xyXG5rby5hcHBseUJpbmRpbmdzKGxpc3RWaWV3KTtcclxuXHJcbi8vIEhhbWJ1cmdlciBNZW51IFNldHVwXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG4gICQoJy5kcmF3ZXInKS5kcmF3ZXIoKTtcclxufSk7XHJcbiIsInZhciBjb250cm9sbGVyID0ge1xyXG4gIGluaXQgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLnVwZGF0ZUd5bXMoKTtcclxuICAgIHNlbGYudXBkYXRlU3Bhd25zKCk7XHJcbiAgICBzZWxmLnVwZGF0ZVBva2VTdG9wcygpO1xyXG4gIH0sXHJcbiAgdXBkYXRlR3ltcyA6IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGZiLm9uQ2hpbGRBZGRlZCgnZ3ltcycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsb2NhdGlvbl9pZCA9IGRhdGEuaWQ7XHJcbiAgICAgIHZhciBuYW1lID0gZGF0YS50aXRsZTtcclxuICAgICAgdmFyIGxhdCA9IGRhdGEubGF0O1xyXG4gICAgICB2YXIgbG5nID0gZGF0YS5sbmc7XHJcbiAgICAgIHZhciBneW0gPSBuZXcgTG9jYXRpb24gKGxvY2F0aW9uX2lkLCAnZ3ltJywgbGF0LCBsbmcsIG5hbWUpO1xyXG4gICAgICBNYXBWaWV3LmNyZWF0ZU1hcmtlcihneW0pO1xyXG4gICAgICBsaXN0Vmlldy5sb2NhdGlvbnMucHVzaChneW0pO1xyXG4gICAgfSk7XHJcbiAgfSxcclxuICB1cGRhdGVQb2tlU3RvcHMgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBmYi5vbkNoaWxkQWRkZWQoJ3Bva2VzdG9wcycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsb2NhdGlvbl9pZCA9IGRhdGEuaWQ7XHJcbiAgICAgIHZhciBuYW1lID0gZGF0YS50aXRsZTtcclxuICAgICAgdmFyIGxhdCA9IGRhdGEubGF0O1xyXG4gICAgICB2YXIgbG5nID0gZGF0YS5sbmc7XHJcbiAgICAgIHZhciBwb2tlc3RvcCA9IG5ldyBMb2NhdGlvbiAobG9jYXRpb25faWQsICdwb2tlc3RvcCcsIGxhdCwgbG5nLCBuYW1lKTtcclxuICAgICAgTWFwVmlldy5jcmVhdGVNYXJrZXIocG9rZXN0b3ApO1xyXG4gICAgICBsaXN0Vmlldy5sb2NhdGlvbnMucHVzaChwb2tlc3RvcCk7XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIHVwZGF0ZVNwYXducyA6IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGZiLm9uQ2hpbGRBZGRlZCgnc3Bhd25zJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgdmFyIGxvY19pZCA9IGRhdGEuaWQ7XHJcbiAgICAgIHZhciBpZCA9IGRhdGEucG9rZW1vbl9pZDtcclxuICAgICAgdmFyIG5hbWUgPSBkYXRhLnBva2Vtb25fbmFtZTtcclxuICAgICAgdmFyIGxhdCA9IGRhdGEubGF0O1xyXG4gICAgICB2YXIgbG5nID0gZGF0YS5sbmc7XHJcblxyXG4gICAgICBtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSA9IG5ldyBTcGF3bkxvY2F0aW9uKGxvY19pZCwgbGF0LCBsbmcsIGlkKTtcblxuICAgICAgLy8gSWYgbmV3IHBva2Vtb246XG4gICAgICBpZiAobW9kZWwucG9rZW1vbnNbaWRdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAvLyBDcmVhdGUgcG9rZW1vbiB3aXRoIGJhcmUgaW5mb1xyXG4gICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXSA9IG5ldyBQb2tlbW9uKGlkLCBuYW1lKTtcclxuICAgICAgICAvLyBVcGRhdGUgbG9jYXRpb24gbmFtZSBhbmQgaWNvblxyXG4gICAgICAgIG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdLnVwZGF0ZVBva2Vtb24obW9kZWwucG9rZW1vbnNbaWRdKTtcclxuICAgICAgICAvLyBDcmVhdGUgdGhlIGxvY2F0aW9uIG1hcmtlclxyXG4gICAgICAgIE1hcFZpZXcuY3JlYXRlTWFya2VyKG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdKTtcclxuICAgICAgICAvLyBQdXNoIGxvY2F0aW9uIHRvIGxpc3Qgdmlld1xyXG4gICAgICAgIGxpc3RWaWV3LmxvY2F0aW9ucy5wdXNoKG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBJZiBvbGQgcG9rZW1vbjpcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGxvY2F0aW9uIG5hbWUgYW5kIGljb25cclxuICAgICAgICBtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXS51cGRhdGVQb2tlbW9uKG1vZGVsLnBva2Vtb25zW2lkXSk7XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsb2NhdGlvbiBtYXJrZXJcclxuICAgICAgICBNYXBWaWV3LmNyZWF0ZU1hcmtlcihtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcbiAgICAgICAgLy8gUHVzaCBsb2NhdGlvbiB0byBsaXN0IHZpZXdcclxuICAgICAgICBsaXN0Vmlldy5sb2NhdGlvbnMucHVzaChtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBkYXRhIGZyb20gcG9nb3NuYXBcclxuICAgICAgaWYgKG1vZGVsLnBva2Vtb25zW2lkXS5wb2dvU25hcFN0YXR1cyAhPT0gJ2xvYWRpbmcnICYmICdvaycpIHtcclxuICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9nb1NuYXBTdGF0dXMgPSAnbG9hZGluZyc7XHJcbiAgICAgICAgcG9nb3NuYXAuZ2V0RGF0YShtb2RlbC5wb2tlbW9uc1tpZF0sIGZ1bmN0aW9uIChwaWNEYXRhKSB7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucGljdHVyZSA9IHBpY0RhdGEucGljdHVyZTtcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS5wZXJtYWxpbmsgPSBwaWNEYXRhLnBlcm1hbGluaztcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS5hdXRob3IgPSBwaWNEYXRhLmF1dGhvcjtcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS5wb2dvc25hcFN0YXR1cyA9IHBpY0RhdGEuc3RhdHVzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVcGRhdGUgZGF0YSBmcm9tIHBva2VhcGlcclxuICAgICAgaWYgKG1vZGVsLnBva2Vtb25zW2lkXS5wb2tlYXBpU3RhdHVzICE9PSAnbG9hZGluZycgJiYgJ29rJykge1xyXG4gICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS5wb2tlYXBpU3RhdHVzID0gJ2xvYWRpbmcnO1xyXG4gICAgICAgIHBva2VhcGkuZ2V0RGF0YShpZCwgZnVuY3Rpb24gKGJpb0RhdGEpIHtcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS53ZWlnaHQgPSBiaW9EYXRhLndlaWdodDtcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS5oZWlnaHQgPSBiaW9EYXRhLmhlaWdodDtcclxuICAgICAgICAgIG1vZGVsLnBva2Vtb25zW2lkXS50eXBlcyA9IGJpb0RhdGEudHlwZXM7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9rZWFwaVN0YXR1cyA9IGJpb0RhdGEuc3RhdHVzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9LFxyXG59O1xyXG5jb250cm9sbGVyLmluaXQoKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
