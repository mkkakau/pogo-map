var fb={db:null,config:{apiKey:"AIzaSyD0LhmulK6Hrn-m-gfhj3XFNUq2OgfEmzg",authDomain:"pogo-63931.firebaseapp.com",databaseURL:"https://pogo-63931.firebaseio.com",storageBucket:"pogo-63931.appspot.com"},start:function(){firebase.initializeApp(this.config),this.db=firebase.database()},onChildAdded:function(t,a){var r=this.db.ref(t);r.on("child_added",function(t){var r=t.val();a(r)})}};fb.start();var pokeapi={urlPrefix:"https://pokeapi.co/api/v2/pokemon/",getData:function(t,a){var r=this.urlPrefix+t;$.getJSON(r,function(t){t.status="ok",a(t)}).fail(function(){var t={weight:null,height:null,types:null,status:"fail"};a(t)})}},map,initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:19.725862,lng:-155.06906},zoom:16})},pogosnap={urlPrefix:"https://www.reddit.com/r/PokemonGoSnap/search.json?",params:{restrict_sr:"true",limit:"1",sort:"top"},getData:function(t,a){var r=this,i=r.urlPrefix;i+="q="+t.name,i+="&restrict_sr="+r.params.restrict_sr,i+="&limit="+r.params.limit,i+="&sort="+r.params.sort;$.getJSON(i,function(t){var i=t.data.children[0].data;if(void 0!==i){var e={picture:r.fixUrl(i.url),author:i.author,permalink:"https://www.reddit.com"+i.permalink,status:"ok"};a(e)}else{var o={picture:"#",author:"",permalink:"",status:"noresults"};a(o)}}).fail(function(){var t={picture:"#",author:"",permalink:"",status:"fail"};a(t)})},fixUrl:function(t){var a=t;return t.search("reddituploads")&&(a=t.split("&amp;").join("&")),t.search("imgur")&&t.search(".jpg")===-1&&(a+=".jpg"),a}};
var Pokemon=function(e,i){var t=this;t.id=e,t.name=i,t.types=[],t.weight="",t.height="",t.pokeapiStatus="loading",t.picture="",t.author="",t.permalink="#",t.pogosnapStatus="loading"},Location=function(e,i,t,o,n){var a=this;a.id=e,a.type=i,a.lat=t,a.lng=o,a.name=n,a.icon="img/"+i+".png",a.markerCreated=!1,a.streetViewUrl="",a.setStreetViewUrl=function(){var e="https://maps.googleapis.com/maps/api/streetview?",i={location:a.lat+","+a.lng,size:"300x200",key:"AIzaSyDnmyJXbQ5xflnzlvc1dJetLgJPbNerL-o"};e+="location="+i.location,e+="&size="+i.size,e+="&key="+i.key,a.streetViewUrl=e},a.setStreetViewUrl()},SpawnLocation=function(e,i,t,o){var n=this;n.id=e,n.type="spawn",n.lat=i,n.lng=t,n.icon="https://pokeapi.co/media/sprites/pokemon/"+o.id+".png",n.name=o.name,n.markerCreated=!1,n.pokemon_id=o.id,n.updatePokeInfo=function(e){n.name=e.name,n.pokemon_id=e.id,n.icon="https://pokeapi.co/media/sprites/pokemon/"+e.id+".png"}},model={pokemons:[],locations:[],markers:[],infowindows:[]};
var MapView={updateMarker:function(i){var o=this;console.log("Location",i.name,"marker created:",i.markerCreated),i.markerCreated===!1&&(model.markers[i.id]=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:map,icon:i.icon,title:i.name,id:i.id}),model.infowindows[i.id]=new google.maps.InfoWindow,model.markers[i.id].addListener("click",function(){model.infowindows[i.id].open(map,model.markers[i.id]),model.markers[i.id].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){model.markers[i.id].setAnimation(null)},1420)}),i.markerCreated=!0),model.infowindows[i.id].setContent(o.fillTemplate(i))},template:'<div id="loc-%id%"><h3>%name%</h3><p>(%lat%, %lng%)</p><p>Google Street View: </p><img src="%streetview%" alt="%name%"></div>',spawnTemplate:'<div id="loc-%id%"><h3>#%pokemon_id% %name%</h3><p>(%lat%, %lng%)</p>%pogosnapStatus%<div class="pic"%pogosnapHidden%><img src="%picture%" alt="%name%" style="width: 15em; height: 15em; object-fit: cover;"><p>Image Source: <a href="%permalink%">/r/PokemonGoSnap</a><br>Posted by: %author%</p></div>%pokeapiStatus%<div class="bio" %pokeapiHidden%><ul><li>Types: %types%</li><li>Weight: %weight% kg</li><li>Height: %height% m</li></ul></div></div>',fillTemplate:function(i){var o,e=model.pokemons[i.pokemon_id];if("spawn"===i.type)if(o=this.spawnTemplate,o=o.split("%pokemon_id%").join(i.pokemon_id),o=o.split("%picture%").join(e.picture),"ok"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(""),o=o.split("%pogosnapStatus%").join(""),o=o.split("%author%").join(e.author),o=o.split("%permalink%").join(e.permalink)):"noresults"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Pokemon does not have a picture</p>")):"loading"===e.pogosnapStatus?(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join('<p>Loading picture...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pogosnapHidden%").join(" hidden"),o=o.split("%pogosnapStatus%").join("<p>Error loading picture from Reddit</p>")),"ok"===e.pokeapiStatus){o=o.split("%pogoapiHidden%").join(""),o=o.split("%pokeapiStatus%").join(""),o=o.split("%weight%").join(e.weight/10),o=o.split("%height%").join(e.height/10);var t=e.types.join(", ");o=o.split("%types%").join(t)}else"loading"===e.pokeapiStatus?(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join('<p>Loading stats...</p><br><img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif" "Loading icon">')):(o=o.split("%pokeapiHidden%").join(" hidden"),o=o.split("%pokeapiStatus%").join("<p>Error loading stats from Pokeapi</p>"));else o=this.template,o=o.split("%streetview%").join(i.streetViewUrl);return o=o.split("%id%").join(i.id),o=o.split("%type%").join(i.type),o=o.split("%lat%").join(i.lat),o=o.split("%lng%").join(i.lng),o=o.split("%name%").join(i.name),o=o.split("%icon%").join(i.icon)}};
var ListViewViewModel=function(){var e=this;e.query=ko.observable(""),e.locations=ko.observableArray(),e.filteredLocations=ko.computed(function(){var o=e.query().toLowerCase(),i=[];return""===o?(model.markers.forEach(function(e){e.setVisible(!0)}),e.locations()):(model.markers.forEach(function(e){e.setVisible(!1)}),e.locations().forEach(function(e){var r=e.name.toLowerCase();r.search(o)>-1&&(model.markers[e.id].setVisible(!0),i.push(e))}),i)})},listView=new ListViewViewModel;ko.applyBindings(listView),$(document).ready(function(){$(".drawer").drawer()});
var controller={init:function(){var o=this;o.updateGyms(),o.updateSpawns(),o.updatePokeStops()},updateGyms:function(){fb.onChildAdded("gyms",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"gym",n,a,t);MapView.updateMarker(p),listView.locations.push(p)})},updatePokeStops:function(){fb.onChildAdded("pokestops",function(o){var e=o.id,t=o.title,n=o.lat,a=o.lng,p=new Location(e,"pokestop",n,a,t);MapView.updateMarker(p),listView.locations.push(p)})},updateSpawns:function(){fb.onChildAdded("spawns",function(o){var e=o.id,t=o.pokemon_id,n=o.pokemon_name,a=o.lat,p=o.lng;model.locations[e]=new SpawnLocation(e,a,p,new Pokemon(t,n)),listView.locations.push(model.locations[e]),void 0===model.pokemons[t]&&(model.pokemons[t]=new Pokemon(t,n),model.locations[e].updatePokeInfo(model.pokemons[t]),MapView.updateMarker(model.locations[e])),"ok"===model.pokemons[t].pogoSnapStatus?(model.locations[e].updatePokeInfo(model.pokemons[t]),MapView.updateMarker(model.locations[e])):pogosnap.getData(model.pokemons[t],function(o){model.pokemons[t].picture=o.picture,model.pokemons[t].permalink=o.permalink,model.pokemons[t].author=o.author,model.pokemons[t].pogosnapStatus=o.status,model.locations[e].updatePokeInfo(model.pokemons[t]),MapView.updateMarker(model.locations[e])}),"ok"===model.pokemons[t].pokeapiStatus?(model.locations[e].updatePokeInfo(model.pokemons[t]),MapView.updateMarker(model.locations[e])):pokeapi.getData(t,function(o){model.pokemons[t].weight=o.weight,model.pokemons[t].height=o.height,model.pokemons[t].pokeapiStatus=o.status,null!==o.types&&o.types.forEach(function(o){model.pokemons[t].types.push(o.type.name)}),model.locations[e].updatePokeInfo(model.pokemons[t]),MapView.updateMarker(model.locations[e])})})}};controller.init();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwaXMuanMiLCJtb2RlbC5qcyIsInZpZXcuanMiLCJsaXN0dmlldy5qcyIsImNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiZmIiLCJkYiIsImNvbmZpZyIsImFwaUtleSIsImF1dGhEb21haW4iLCJkYXRhYmFzZVVSTCIsInN0b3JhZ2VCdWNrZXQiLCJzdGFydCIsImZpcmViYXNlIiwiaW5pdGlhbGl6ZUFwcCIsInRoaXMiLCJkYXRhYmFzZSIsIm9uQ2hpbGRBZGRlZCIsInJlZiIsImNiIiwibXlSZWYiLCJvbiIsInNuYXAiLCJkYXRhIiwidmFsIiwicG9rZWFwaSIsInVybFByZWZpeCIsImdldERhdGEiLCJpZCIsInVybCIsIiQiLCJnZXRKU09OIiwic3RhdHVzIiwiZmFpbCIsIm5vRGF0YSIsIndlaWdodCIsImhlaWdodCIsInR5cGVzIiwibWFwIiwiaW5pdE1hcCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2VudGVyIiwibGF0IiwibG5nIiwiem9vbSIsInBvZ29zbmFwIiwicGFyYW1zIiwicmVzdHJpY3Rfc3IiLCJsaW1pdCIsInNvcnQiLCJwb2tlbW9uIiwic2VsZiIsIm5hbWUiLCJsaXN0aW5nIiwiY2hpbGRyZW4iLCJ1bmRlZmluZWQiLCJteURhdGEiLCJwaWN0dXJlIiwiZml4VXJsIiwiYXV0aG9yIiwicGVybWFsaW5rIiwibmV3VXJsIiwic2VhcmNoIiwic3BsaXQiLCJqb2luIiwiUG9rZW1vbiIsInBva2VhcGlTdGF0dXMiLCJwb2dvc25hcFN0YXR1cyIsIkxvY2F0aW9uIiwidHlwZSIsImljb24iLCJtYXJrZXJDcmVhdGVkIiwic3RyZWV0Vmlld1VybCIsInNldFN0cmVldFZpZXdVcmwiLCJsb2NhdGlvbiIsInNpemUiLCJrZXkiLCJTcGF3bkxvY2F0aW9uIiwicG9rZW1vbl9pZCIsInVwZGF0ZVBva2VJbmZvIiwibW9kZWwiLCJwb2tlbW9ucyIsImxvY2F0aW9ucyIsIm1hcmtlcnMiLCJpbmZvd2luZG93cyIsIk1hcFZpZXciLCJ1cGRhdGVNYXJrZXIiLCJjb25zb2xlIiwibG9nIiwiTWFya2VyIiwicG9zaXRpb24iLCJ0aXRsZSIsIkluZm9XaW5kb3ciLCJhZGRMaXN0ZW5lciIsIm9wZW4iLCJzZXRBbmltYXRpb24iLCJBbmltYXRpb24iLCJCT1VOQ0UiLCJzZXRUaW1lb3V0Iiwic2V0Q29udGVudCIsImZpbGxUZW1wbGF0ZSIsInRlbXBsYXRlIiwic3Bhd25UZW1wbGF0ZSIsImNvbnRlbnQiLCJMaXN0Vmlld1ZpZXdNb2RlbCIsInF1ZXJ5Iiwia28iLCJvYnNlcnZhYmxlIiwib2JzZXJ2YWJsZUFycmF5IiwiZmlsdGVyZWRMb2NhdGlvbnMiLCJjb21wdXRlZCIsImZpbHRlciIsInRvTG93ZXJDYXNlIiwiZm9yRWFjaCIsIm1hcmtlciIsInNldFZpc2libGUiLCJsb2MiLCJwdXNoIiwibGlzdFZpZXciLCJhcHBseUJpbmRpbmdzIiwicmVhZHkiLCJkcmF3ZXIiLCJjb250cm9sbGVyIiwiaW5pdCIsInVwZGF0ZUd5bXMiLCJ1cGRhdGVTcGF3bnMiLCJ1cGRhdGVQb2tlU3RvcHMiLCJsb2NhdGlvbl9pZCIsImd5bSIsInBva2VzdG9wIiwibG9jX2lkIiwicG9rZW1vbl9uYW1lIiwicG9nb1NuYXBTdGF0dXMiLCJwaWNEYXRhIiwiYmlvRGF0YSIsImkiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLEtBQ0ZDLEdBQUssS0FDTEMsUUFDRUMsT0FBUSwwQ0FDUkMsV0FBWSw2QkFDWkMsWUFBYSxvQ0FDYkMsY0FBZSwwQkFFakJDLE1BQVEsV0FDTkMsU0FBU0MsY0FBY0MsS0FBS1IsUUFDNUJRLEtBQUtULEdBQUtPLFNBQVNHLFlBRXJCQyxhQUFlLFNBQVVDLEVBQUtDLEdBQzVCLEdBQUlDLEdBQVFMLEtBQUtULEdBQUdZLElBQUlBLEVBQ3hCRSxHQUFNQyxHQUFHLGNBQWUsU0FBVUMsR0FDaEMsR0FBSUMsR0FBT0QsRUFBS0UsS0FDaEJMLEdBQUdJLE1BSVRsQixJQUFHTyxPQUVILElBQUlhLFVB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QUFTekQsSUFDdEQ2RCxRQUFRQyxhQUFhTixNQUFNRSxVQUFVZ0QsS0FHckM3RyxRQUFRRSxRQUFRQyxFQUFJLFNBQVU4RyxHQUM1QnRELE1BQU1DLFNBQVN6RCxHQUFJTyxPQUFTdUcsRUFBUXZHLE9BQ3BDaUQsTUFBTUMsU0FBU3pELEdBQUlRLE9BQVNzRyxFQUFRdEcsT0FDcENnRCxNQUFNQyxTQUFTekQsR0FBSTBDLGNBQWdCb0UsRUFBUTFHLE9BQ3RCLE9BQWxCMEcsRUFBUXJHLE9BQ1RxRyxFQUFRckcsTUFBTWdGLFFBQVEsU0FBVXNCLEdBQzlCdkQsTUFBTUMsU0FBU3pELEdBQUlTLE1BQU1vRixLQUFLa0IsRUFBRWxFLEtBQUtqQixRQUd6QzRCLE1BQU1FLFVBQVVnRCxHQUFRbkQsZUFBZUMsTUFBTUMsU0FBU3pELElBQ3RENkQsUUFBUUMsYUFBYU4sTUFBTUUsVUFBVWdELFNBTS9DUixZQUFXQyIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlyZWJhc2VcclxudmFyIGZiID0ge1xyXG4gIGRiIDogbnVsbCxcclxuICBjb25maWcgOiB7XHJcbiAgICBhcGlLZXk6IFwiQUl6YVN5RDBMaG11bEs2SHJuLW0tZ2ZoajNYRk5VcTJPZ2ZFbXpnXCIsXHJcbiAgICBhdXRoRG9tYWluOiBcInBvZ28tNjM5MzEuZmlyZWJhc2VhcHAuY29tXCIsXHJcbiAgICBkYXRhYmFzZVVSTDogXCJodHRwczovL3BvZ28tNjM5MzEuZmlyZWJhc2Vpby5jb21cIixcclxuICAgIHN0b3JhZ2VCdWNrZXQ6IFwicG9nby02MzkzMS5hcHBzcG90LmNvbVwiLFxyXG4gIH0sXHJcbiAgc3RhcnQgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBmaXJlYmFzZS5pbml0aWFsaXplQXBwKHRoaXMuY29uZmlnKTtcclxuICAgIHRoaXMuZGIgPSBmaXJlYmFzZS5kYXRhYmFzZSgpO1xyXG4gIH0sXHJcbiAgb25DaGlsZEFkZGVkIDogZnVuY3Rpb24gKHJlZiwgY2IpIHtcclxuICAgIHZhciBteVJlZiA9IHRoaXMuZGIucmVmKHJlZik7XHJcbiAgICBteVJlZi5vbignY2hpbGRfYWRkZWQnLCBmdW5jdGlvbiAoc25hcCkge1xyXG4gICAgICB2YXIgZGF0YSA9IHNuYXAudmFsKCk7XHJcbiAgICAgIGNiKGRhdGEpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59O1xyXG5mYi5zdGFydCgpO1xyXG4vLyBQb2tlYXBpXHJcbnZhciBwb2tlYXBpID0ge1xyXG4gIHVybFByZWZpeCA6ICdodHRwczovL3Bva2VhcGkuY28vYXBpL3YyL3Bva2Vtb24vJyxcclxuICBnZXREYXRhIDogZnVuY3Rpb24gKGlkLCBjYikge1xyXG4gICAgdmFyIHVybCA9IHRoaXMudXJsUHJlZml4ICsgaWQ7XHJcbiAgICB2YXIganF4aHIgPSAkLmdldEpTT04odXJsLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICBkYXRhLnN0YXR1cyA9ICdvayc7XHJcbiAgICAgIGNiKGRhdGEpO1xyXG4gICAgfSlcclxuICAgIC5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIG5vRGF0YSA9IHtcclxuICAgICAgICB3ZWlnaHQ6IG51bGwsXHJcbiAgICAgICAgaGVpZ2h0OiBudWxsLFxyXG4gICAgICAgIHR5cGVzOiBudWxsLFxyXG4gICAgICAgIHN0YXR1czogJ2ZhaWwnXHJcbiAgICAgIH07XHJcbiAgICAgIGNiKG5vRGF0YSk7XHJcbiAgICB9KTtcclxuICB9LFxyXG59O1xyXG4vLyBHb29nbGUgTWFwc1xyXG52YXIgbWFwO1xyXG52YXIgaW5pdE1hcCA9IGZ1bmN0aW9uICgpIHtcclxuICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgY2VudGVyOiB7bGF0OiAxOS43MjU4NjIsIGxuZzogLTE1NS4wNjkwNn0sXHJcbiAgICB6b29tOiAxNlxyXG4gIH0pO1xyXG59O1xyXG4vLyBSZWRkaXQgL3IvUG9rZW1vbkdvU25hcFxyXG52YXIgcG9nb3NuYXAgPSB7XHJcbiAgdXJsUHJlZml4IDogJ2h0dHBzOi8vd3d3LnJlZGRpdC5jb20vci9Qb2tlbW9uR29TbmFwL3NlYXJjaC5qc29uPycsXHJcbiAgcGFyYW1zIDoge1xyXG4gICAgcmVzdHJpY3Rfc3IgOiAndHJ1ZScsXHJcbiAgICBsaW1pdCA6ICcxJyxcclxuICAgIHNvcnQgOiAndG9wJ1xyXG4gIH0sXHJcbiAgZ2V0RGF0YSA6IGZ1bmN0aW9uIChwb2tlbW9uLCBjYikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIHVybCA9IHNlbGYudXJsUHJlZml4O1xyXG4gICAgdXJsICs9ICdxPScgKyBwb2tlbW9uLm5hbWU7XHJcbiAgICB1cmwgKz0gJyZyZXN0cmljdF9zcj0nICsgc2VsZi5wYXJhbXMucmVzdHJpY3Rfc3I7XHJcbiAgICB1cmwgKz0gJyZsaW1pdD0nICsgc2VsZi5wYXJhbXMubGltaXQ7XHJcbiAgICB1cmwgKz0gJyZzb3J0PScgKyBzZWxmLnBhcmFtcy5zb3J0O1xyXG5cclxuICAgIHZhciBqcXhociA9ICQuZ2V0SlNPTih1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsaXN0aW5nID0gZGF0YS5kYXRhLmNoaWxkcmVuWzBdLmRhdGE7XHJcbiAgICAgIGlmIChsaXN0aW5nICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YXIgbXlEYXRhID0ge1xyXG4gICAgICAgICAgcGljdHVyZTogc2VsZi5maXhVcmwobGlzdGluZy51cmwpLFxyXG4gICAgICAgICAgYXV0aG9yOiBsaXN0aW5nLmF1dGhvcixcclxuICAgICAgICAgIHBlcm1hbGluazogJ2h0dHBzOi8vd3d3LnJlZGRpdC5jb20nICsgbGlzdGluZy5wZXJtYWxpbmssXHJcbiAgICAgICAgICBzdGF0dXM6ICdvaydcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNiKG15RGF0YSk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIG5vRGF0YSA9IHtcclxuICAgICAgICAgIHBpY3R1cmU6ICcjJyxcclxuICAgICAgICAgIGF1dGhvcjogJycsXHJcbiAgICAgICAgICBwZXJtYWxpbms6ICcnLFxyXG4gICAgICAgICAgc3RhdHVzOiAnbm9yZXN1bHRzJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY2Iobm9EYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIC5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIG5vRGF0YSA9IHtcclxuICAgICAgICBwaWN0dXJlOiAnIycsXHJcbiAgICAgICAgYXV0aG9yOiAnJyxcclxuICAgICAgICBwZXJtYWxpbms6ICcnLFxyXG4gICAgICAgIHN0YXR1czogJ2ZhaWwnXHJcbiAgICAgIH07XHJcbiAgICAgIGNiKG5vRGF0YSk7XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIGZpeFVybCA6IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgIHZhciBuZXdVcmwgPSB1cmw7XHJcbiAgICBpZiAodXJsLnNlYXJjaCgncmVkZGl0dXBsb2FkcycpKSB7XHJcbiAgICAgIG5ld1VybCA9IHVybC5zcGxpdCgnJmFtcDsnKS5qb2luKCcmJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodXJsLnNlYXJjaCgnaW1ndXInKSAmJiB1cmwuc2VhcmNoKCcuanBnJykgPT09IC0xKSB7XHJcbiAgICAgIG5ld1VybCArPSAnLmpwZyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VXJsO1xyXG4gIH0sXHJcbn07XHJcbiIsIi8vIFBva2Vtb24gQ2xhc3NcclxudmFyIFBva2Vtb24gPSBmdW5jdGlvbiAoaWQsIG5hbWUpIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5pZCA9IGlkO1xyXG4gIHNlbGYubmFtZSA9IG5hbWU7XHJcbiAgLy8gVXBkYXRlZCBmcm9tIFBva2VhcGk6XHJcbiAgc2VsZi50eXBlcyA9IFtdO1xyXG4gIHNlbGYud2VpZ2h0ID0gJyc7XHJcbiAgc2VsZi5oZWlnaHQgPSAnJztcclxuICBzZWxmLnBva2VhcGlTdGF0dXMgPSAnbG9hZGluZyc7XHJcbiAgLy8gVXBkYXRlZCBmcm9tIC9yL1Bva2Vtb25Hb1NuYXA6XHJcbiAgc2VsZi5waWN0dXJlID0gJyc7XHJcbiAgc2VsZi5hdXRob3IgPSAnJztcclxuICBzZWxmLnBlcm1hbGluayA9ICcjJztcclxuICBzZWxmLnBvZ29zbmFwU3RhdHVzID0gJ2xvYWRpbmcnO1xyXG59O1xyXG4vLyBMb2NhdGlvbiBDbGFzc1xyXG52YXIgTG9jYXRpb24gPSBmdW5jdGlvbiAoaWQsIHR5cGUsIGxhdCwgbG5nLCBuYW1lKSB7XHJcbiAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gIHNlbGYuaWQgPSBpZDtcclxuICBzZWxmLnR5cGUgPSB0eXBlOyAvLyBneW0sIHBva2VzdG9wXHJcbiAgc2VsZi5sYXQgPSBsYXQ7XHJcbiAgc2VsZi5sbmcgPSBsbmc7XHJcbiAgc2VsZi5uYW1lID0gbmFtZTtcclxuICBzZWxmLmljb24gPSAnaW1nLycgKyB0eXBlICsgJy5wbmcnO1xyXG4gIHNlbGYubWFya2VyQ3JlYXRlZCA9IGZhbHNlO1xyXG4gIHNlbGYuc3RyZWV0Vmlld1VybCA9ICcnO1xyXG4gIHNlbGYuc2V0U3RyZWV0Vmlld1VybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciB1cmwgPSAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3N0cmVldHZpZXc/JztcclxuICAgIHZhciBwYXJhbXMgPSB7XHJcbiAgICAgIGxvY2F0aW9uIDogc2VsZi5sYXQgKyAnLCcgKyBzZWxmLmxuZyxcclxuICAgICAgc2l6ZSA6ICczMDB4MjAwJyxcclxuICAgICAga2V5IDogJ0FJemFTeURubXlKWGJRNXhmbG56bHZjMWRKZXRMZ0pQYk5lckwtbydcclxuICAgIH07XHJcbiAgICB1cmwgKz0gJ2xvY2F0aW9uPScgKyBwYXJhbXMubG9jYXRpb247XHJcbiAgICB1cmwgKz0gJyZzaXplPScgKyBwYXJhbXMuc2l6ZTtcclxuICAgIHVybCArPSAnJmtleT0nICsgcGFyYW1zLmtleTtcclxuICAgIHNlbGYuc3RyZWV0Vmlld1VybCA9IHVybDtcclxuICB9O1xyXG4gIHNlbGYuc2V0U3RyZWV0Vmlld1VybCgpO1xyXG59O1xyXG4vLyBTcGF3biBMb2NhdGlvbiBDbGFzc1xyXG52YXIgU3Bhd25Mb2NhdGlvbiA9IGZ1bmN0aW9uIChpZCwgbGF0LCBsbmcsIHBva2Vtb24pIHtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5pZCA9IGlkO1xyXG4gIHNlbGYudHlwZSA9ICdzcGF3bic7XHJcbiAgc2VsZi5sYXQgPSBsYXQ7XHJcbiAgc2VsZi5sbmcgPSBsbmc7XHJcbiAgc2VsZi5pY29uID0gJ2h0dHBzOi8vcG9rZWFwaS5jby9tZWRpYS9zcHJpdGVzL3Bva2Vtb24vJyArIHBva2Vtb24uaWQgKyAnLnBuZyc7XHJcbiAgc2VsZi5uYW1lID0gcG9rZW1vbi5uYW1lO1xyXG4gIHNlbGYubWFya2VyQ3JlYXRlZCA9IGZhbHNlO1xyXG4gIHNlbGYucG9rZW1vbl9pZCA9IHBva2Vtb24uaWQ7XHJcbiAgc2VsZi51cGRhdGVQb2tlSW5mbyA9IGZ1bmN0aW9uIChwb2tlbW9uKSB7XHJcbiAgICBzZWxmLm5hbWUgPSBwb2tlbW9uLm5hbWU7XHJcbiAgICBzZWxmLnBva2Vtb25faWQgPSBwb2tlbW9uLmlkO1xyXG4gICAgc2VsZi5pY29uID0gJ2h0dHBzOi8vcG9rZWFwaS5jby9tZWRpYS9zcHJpdGVzL3Bva2Vtb24vJyArIHBva2Vtb24uaWQgKyAnLnBuZyc7XHJcbiAgfTtcclxufTtcclxuXHJcbnZhciBtb2RlbCA9IHtcclxuICBwb2tlbW9ucyA6IFtdLFxyXG4gIGxvY2F0aW9ucyA6IFtdLFxyXG4gIG1hcmtlcnMgOiBbXSxcclxuICBpbmZvd2luZG93cyA6IFtdXHJcbn07XHJcblxyXG4vLyAvLyBUZXN0aW5nIE1vZGVsXHJcbi8vIG1vZGVsLnBva2Vtb25zWzFdID0gbmV3IFBva2Vtb24oMSk7XHJcbi8vIG1vZGVsLnBva2Vtb25zWzFdLmlkID0gJzEnO1xyXG4vLyBtb2RlbC5wb2tlbW9uc1sxXS5uYW1lID0gJ2J1bGJhc2F1cic7XHJcbi8vXHJcbi8vIHZhciBzcGF3biA9IG5ldyBTcGF3bkxvY2F0aW9uKDAsIDAsIG1vZGVsLnBva2Vtb25zWzFdKTtcclxuLy8gY29uc29sZS5sb2coc3Bhd24pO1xyXG4iLCJ2YXIgTWFwVmlldyA9IHtcclxuICB1cGRhdGVNYXJrZXIgOiBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGNvbnNvbGUubG9nKCdMb2NhdGlvbicsIGxvY2F0aW9uLm5hbWUsICdtYXJrZXIgY3JlYXRlZDonLCBsb2NhdGlvbi5tYXJrZXJDcmVhdGVkKTtcclxuICAgIGlmIChsb2NhdGlvbi5tYXJrZXJDcmVhdGVkID09PSBmYWxzZSkge1xyXG4gICAgICBtb2RlbC5tYXJrZXJzW2xvY2F0aW9uLmlkXSA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgIHBvc2l0aW9uOiB7bGF0OiBsb2NhdGlvbi5sYXQsIGxuZzogbG9jYXRpb24ubG5nfSxcclxuICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICBpY29uOiBsb2NhdGlvbi5pY29uLFxyXG4gICAgICAgIHRpdGxlOiBsb2NhdGlvbi5uYW1lLFxyXG4gICAgICAgIGlkOiBsb2NhdGlvbi5pZFxyXG4gICAgICB9KTtcclxuICAgICAgbW9kZWwuaW5mb3dpbmRvd3NbbG9jYXRpb24uaWRdID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcclxuICAgICAgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0uYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIE9wZW4gaW5mb3dpbmRvd1xyXG4gICAgICAgIG1vZGVsLmluZm93aW5kb3dzW2xvY2F0aW9uLmlkXS5vcGVuKG1hcCwgbW9kZWwubWFya2Vyc1tsb2NhdGlvbi5pZF0pO1xyXG4gICAgICAgIC8vIEJvdW5jZSB0d2ljZSBvbiBjbGlja1xyXG4gICAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIG1vZGVsLm1hcmtlcnNbbG9jYXRpb24uaWRdLnNldEFuaW1hdGlvbihudWxsKTtcclxuICAgICAgICB9LCAxNDIwKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGxvY2F0aW9uLm1hcmtlckNyZWF0ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgbW9kZWwuaW5mb3dpbmRvd3NbbG9jYXRpb24uaWRdLnNldENvbnRlbnQoc2VsZi5maWxsVGVtcGxhdGUobG9jYXRpb24pKTtcclxuICB9LFxyXG4gIHRlbXBsYXRlIDpcclxuXHJcbiAgJzxkaXYgaWQ9XCJsb2MtJWlkJVwiPicgK1xyXG4gICAgJzxoMz4lbmFtZSU8L2gzPicgK1xyXG4gICAgJzxwPiglbGF0JSwgJWxuZyUpPC9wPicgK1xyXG4gICAgJzxwPkdvb2dsZSBTdHJlZXQgVmlldzogPC9wPicgK1xyXG4gICAgJzxpbWcgc3JjPVwiJXN0cmVldHZpZXclXCIgYWx0PVwiJW5hbWUlXCI+JyArXHJcbiAgJzwvZGl2PicsXHJcblxyXG4gIHNwYXduVGVtcGxhdGUgOlxyXG5cclxuICAnPGRpdiBpZD1cImxvYy0laWQlXCI+JyArXHJcbiAgICAnPGgzPiMlcG9rZW1vbl9pZCUgJW5hbWUlPC9oMz4nICtcclxuICAgICc8cD4oJWxhdCUsICVsbmclKTwvcD4nICtcclxuICAgICclcG9nb3NuYXBTdGF0dXMlJyArXHJcbiAgICAnPGRpdiBjbGFzcz1cInBpY1wiJXBvZ29zbmFwSGlkZGVuJT4nICtcclxuICAgICAgJzxpbWcgc3JjPVwiJXBpY3R1cmUlXCIgYWx0PVwiJW5hbWUlXCIgc3R5bGU9XCJ3aWR0aDogMTVlbTsgaGVpZ2h0OiAxNWVtOyBvYmplY3QtZml0OiBjb3ZlcjtcIj4nICtcclxuICAgICAgJzxwPicgK1xyXG4gICAgICAgICdJbWFnZSBTb3VyY2U6IDxhIGhyZWY9XCIlcGVybWFsaW5rJVwiPi9yL1Bva2Vtb25Hb1NuYXA8L2E+PGJyPicgK1xyXG4gICAgICAgICdQb3N0ZWQgYnk6ICVhdXRob3IlJyArXHJcbiAgICAgICc8L3A+JyArXHJcbiAgICAnPC9kaXY+JyArXHJcbiAgICAnJXBva2VhcGlTdGF0dXMlJyArXHJcbiAgICAnPGRpdiBjbGFzcz1cImJpb1wiICVwb2tlYXBpSGlkZGVuJT4nICtcclxuICAgICAgJzx1bD4nICtcclxuICAgICAgICAnPGxpPlR5cGVzOiAldHlwZXMlPC9saT4nICtcclxuICAgICAgICAnPGxpPldlaWdodDogJXdlaWdodCUga2c8L2xpPicgK1xyXG4gICAgICAgICc8bGk+SGVpZ2h0OiAlaGVpZ2h0JSBtPC9saT4nICtcclxuICAgICAgJzwvdWw+JyArXHJcbiAgICAnPC9kaXY+JytcclxuICAnPC9kaXY+JyxcclxuXHJcbiAgZmlsbFRlbXBsYXRlIDogZnVuY3Rpb24gKGxvY2F0aW9uKSB7XHJcbiAgICB2YXIgY29udGVudDtcclxuICAgIHZhciBwb2tlbW9uID0gbW9kZWwucG9rZW1vbnNbbG9jYXRpb24ucG9rZW1vbl9pZF07XHJcblxyXG4gICAgLy8gUG9rZW1vbiBzcGVjaWZpYyB0ZW1wbGF0ZSBpdGVtczpcclxuICAgIGlmIChsb2NhdGlvbi50eXBlID09PSAnc3Bhd24nKSB7XHJcbiAgICAgIGNvbnRlbnQgPSB0aGlzLnNwYXduVGVtcGxhdGU7XHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZW1vbl9pZCUnKS5qb2luKGxvY2F0aW9uLnBva2Vtb25faWQpO1xyXG4gICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBpY3R1cmUlJykuam9pbihwb2tlbW9uLnBpY3R1cmUpO1xyXG5cclxuICAgICAgaWYgKHBva2Vtb24ucG9nb3NuYXBTdGF0dXMgPT09ICdvaycpIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29zbmFwSGlkZGVuJScpLmpvaW4oJycpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBTdGF0dXMlJykuam9pbignJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVhdXRob3IlJykuam9pbihwb2tlbW9uLmF1dGhvcik7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwZXJtYWxpbmslJykuam9pbihwb2tlbW9uLnBlcm1hbGluayk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVsc2UgaWYgKHBva2Vtb24ucG9nb3NuYXBTdGF0dXMgPT09ICdub3Jlc3VsdHMnKSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcEhpZGRlbiUnKS5qb2luKCcgaGlkZGVuJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcFN0YXR1cyUnKS5qb2luKCc8cD5Qb2tlbW9uIGRvZXMgbm90IGhhdmUgYSBwaWN0dXJlPC9wPicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBlbHNlIGlmIChwb2tlbW9uLnBvZ29zbmFwU3RhdHVzID09PSAnbG9hZGluZycpIHtcclxuICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBIaWRkZW4lJykuam9pbignIGhpZGRlbicpO1xyXG4gICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2dvc25hcFN0YXR1cyUnKS5qb2luKCc8cD5Mb2FkaW5nIHBpY3R1cmUuLi48L3A+PGJyPicgK1xyXG4gICAgICAgJzxpbWcgc3JjPVwiaHR0cHM6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy9kL2RlL0FqYXgtbG9hZGVyLmdpZlwiIFwiTG9hZGluZyBpY29uXCI+Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBIaWRkZW4lJykuam9pbignIGhpZGRlbicpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9nb3NuYXBTdGF0dXMlJykuam9pbignPHA+RXJyb3IgbG9hZGluZyBwaWN0dXJlIGZyb20gUmVkZGl0PC9wPicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZihwb2tlbW9uLnBva2VhcGlTdGF0dXMgPT09ICdvaycpIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBvZ29hcGlIaWRkZW4lJykuam9pbignJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlYXBpU3RhdHVzJScpLmpvaW4oJycpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCcld2VpZ2h0JScpLmpvaW4ocG9rZW1vbi53ZWlnaHQgLyAxMCk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVoZWlnaHQlJykuam9pbihwb2tlbW9uLmhlaWdodCAvIDEwKTtcclxuICAgICAgICB2YXIgdHlwZXMgPSBwb2tlbW9uLnR5cGVzLmpvaW4oJywgJyk7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyV0eXBlcyUnKS5qb2luKHR5cGVzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSBpZiAocG9rZW1vbi5wb2tlYXBpU3RhdHVzID09PSAnbG9hZGluZycpIHtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2VhcGlIaWRkZW4lJykuam9pbignIGhpZGRlbicpO1xyXG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclcG9rZWFwaVN0YXR1cyUnKS5qb2luKCc8cD5Mb2FkaW5nIHN0YXRzLi4uPC9wPjxicj4nICtcclxuICAgICAgICAnPGltZyBzcmM9XCJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL2QvZGUvQWpheC1sb2FkZXIuZ2lmXCIgXCJMb2FkaW5nIGljb25cIj4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVwb2tlYXBpSGlkZGVuJScpLmpvaW4oJyBoaWRkZW4nKTtcclxuICAgICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXBva2VhcGlTdGF0dXMlJykuam9pbignPHA+RXJyb3IgbG9hZGluZyBzdGF0cyBmcm9tIFBva2VhcGk8L3A+Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIEdlbmVyaWMgbG9jYXRpb24gbWFya2VyIHRlbXBsYXRlIGl0ZW1zOlxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnRlbnQgPSB0aGlzLnRlbXBsYXRlO1xyXG4gICAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXN0cmVldHZpZXclJykuam9pbihsb2NhdGlvbi5zdHJlZXRWaWV3VXJsKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUZW1wbGF0ZSBpdGVtcyBmb3IgYWxsIGxvY2F0aW9uczpcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclaWQlJykuam9pbihsb2NhdGlvbi5pZCk7XHJcbiAgICBjb250ZW50ID0gY29udGVudC5zcGxpdCgnJXR5cGUlJykuam9pbihsb2NhdGlvbi50eXBlKTtcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclbGF0JScpLmpvaW4obG9jYXRpb24ubGF0KTtcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclbG5nJScpLmpvaW4obG9jYXRpb24ubG5nKTtcclxuICAgIGNvbnRlbnQgPSBjb250ZW50LnNwbGl0KCclbmFtZSUnKS5qb2luKGxvY2F0aW9uLm5hbWUpO1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3BsaXQoJyVpY29uJScpLmpvaW4obG9jYXRpb24uaWNvbik7XHJcblxyXG4gICAgcmV0dXJuIGNvbnRlbnQ7XHJcbiAgfVxyXG59O1xyXG4iLCJ2YXIgTGlzdFZpZXdWaWV3TW9kZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gIHNlbGYucXVlcnkgPSBrby5vYnNlcnZhYmxlKCcnKTtcclxuICBzZWxmLmxvY2F0aW9ucyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gIHNlbGYuZmlsdGVyZWRMb2NhdGlvbnMgPSBrby5jb21wdXRlZChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZmlsdGVyID0gc2VsZi5xdWVyeSgpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB2YXIgZmlsdGVyZWRMb2NhdGlvbnMgPSBbXTtcclxuXHJcbiAgICBpZiAoZmlsdGVyID09PSAnJykge1xyXG4gICAgICAvLyBNYWtlIGFsbCBtYXJrZXJzIHZpc2libGVcclxuICAgICAgbW9kZWwubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChtYXJrZXIpIHtcclxuICAgICAgICBtYXJrZXIuc2V0VmlzaWJsZSh0cnVlKTtcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIFJldHVybiBhbGwgbG9jYXRpb25zIGlmIGZpbHRlciBpcyBibGFua1xyXG4gICAgICByZXR1cm4gc2VsZi5sb2NhdGlvbnMoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBIaWRlIGFsbCBtYXJrZXJzXHJcbiAgICAgIG1vZGVsLm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAobWFya2VyKSB7XHJcbiAgICAgICAgbWFya2VyLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgLy8gUHVzaCBsb2NhdGlvbiB0byBmaWx0ZXJlZExvY2F0aW9ucyBhbmRcclxuICAgICAgLy8gTWFrZSBtYXJrZXIgZm9yIGZpbHRlcmVkIGxvY2F0aW9uIHZpc2libGVcclxuICAgICAgc2VsZi5sb2NhdGlvbnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2MpIHtcclxuICAgICAgICB2YXIgbmFtZSA9IGxvYy5uYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKG5hbWUuc2VhcmNoKGZpbHRlcikgPiAtMSkge1xyXG4gICAgICAgICAgbW9kZWwubWFya2Vyc1tsb2MuaWRdLnNldFZpc2libGUodHJ1ZSk7XHJcbiAgICAgICAgICBmaWx0ZXJlZExvY2F0aW9ucy5wdXNoKGxvYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZpbHRlcmVkTG9jYXRpb25zO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG52YXIgbGlzdFZpZXcgPSBuZXcgTGlzdFZpZXdWaWV3TW9kZWwoKTtcclxua28uYXBwbHlCaW5kaW5ncyhsaXN0Vmlldyk7XHJcblxyXG4vLyBIYW1idXJnZXIgTWVudSBTZXR1cFxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAkKCcuZHJhd2VyJykuZHJhd2VyKCk7XHJcbn0pO1xyXG4iLCJ2YXIgY29udHJvbGxlciA9IHtcclxuICBpbml0IDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi51cGRhdGVHeW1zKCk7XHJcbiAgICBzZWxmLnVwZGF0ZVNwYXducygpO1xyXG4gICAgc2VsZi51cGRhdGVQb2tlU3RvcHMoKTtcclxuICB9LFxyXG4gIHVwZGF0ZUd5bXMgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBmYi5vbkNoaWxkQWRkZWQoJ2d5bXMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICB2YXIgbG9jYXRpb25faWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgbmFtZSA9IGRhdGEudGl0bGU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG4gICAgICB2YXIgZ3ltID0gbmV3IExvY2F0aW9uIChsb2NhdGlvbl9pZCwgJ2d5bScsIGxhdCwgbG5nLCBuYW1lKTtcclxuICAgICAgTWFwVmlldy51cGRhdGVNYXJrZXIoZ3ltKTtcclxuICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2goZ3ltKTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgdXBkYXRlUG9rZVN0b3BzIDogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgZmIub25DaGlsZEFkZGVkKCdwb2tlc3RvcHMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICB2YXIgbG9jYXRpb25faWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgbmFtZSA9IGRhdGEudGl0bGU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG4gICAgICB2YXIgcG9rZXN0b3AgPSBuZXcgTG9jYXRpb24gKGxvY2F0aW9uX2lkLCAncG9rZXN0b3AnLCBsYXQsIGxuZywgbmFtZSk7XHJcbiAgICAgIE1hcFZpZXcudXBkYXRlTWFya2VyKHBva2VzdG9wKTtcclxuICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2gocG9rZXN0b3ApO1xyXG4gICAgfSk7XHJcbiAgfSxcclxuICB1cGRhdGVTcGF3bnMgOiBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBmYi5vbkNoaWxkQWRkZWQoJ3NwYXducycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIHZhciBsb2NfaWQgPSBkYXRhLmlkO1xyXG4gICAgICB2YXIgaWQgPSBkYXRhLnBva2Vtb25faWQ7XHJcbiAgICAgIHZhciBuYW1lID0gZGF0YS5wb2tlbW9uX25hbWU7XHJcbiAgICAgIHZhciBsYXQgPSBkYXRhLmxhdDtcclxuICAgICAgdmFyIGxuZyA9IGRhdGEubG5nO1xyXG5cclxuICAgICAgbW9kZWwubG9jYXRpb25zW2xvY19pZF0gPSBuZXcgU3Bhd25Mb2NhdGlvbihsb2NfaWQsIGxhdCwgbG5nLCBuZXcgUG9rZW1vbihpZCwgbmFtZSkpO1xuICAgICAgbGlzdFZpZXcubG9jYXRpb25zLnB1c2gobW9kZWwubG9jYXRpb25zW2xvY19pZF0pO1xyXG4gICAgICBpZiAobW9kZWwucG9rZW1vbnNbaWRdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0gPSBuZXcgUG9rZW1vbihpZCwgbmFtZSk7XHJcbiAgICAgICAgbW9kZWwubG9jYXRpb25zW2xvY19pZF0udXBkYXRlUG9rZUluZm8obW9kZWwucG9rZW1vbnNbaWRdKTtcclxuICAgICAgICBNYXBWaWV3LnVwZGF0ZU1hcmtlcihtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcblxyXG4gICAgICB9XHJcbiAgICAgIC8vIFVwZGF0ZSBkYXRhIGZyb20gcG9nb3NuYXBcclxuICAgICAgaWYgKG1vZGVsLnBva2Vtb25zW2lkXS5wb2dvU25hcFN0YXR1cyA9PT0gJ29rJykge1xyXG4gICAgICAgIG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdLnVwZGF0ZVBva2VJbmZvKG1vZGVsLnBva2Vtb25zW2lkXSk7XHJcbiAgICAgICAgTWFwVmlldy51cGRhdGVNYXJrZXIobW9kZWwubG9jYXRpb25zW2xvY19pZF0pO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHBvZ29zbmFwLmdldERhdGEobW9kZWwucG9rZW1vbnNbaWRdLCBmdW5jdGlvbiAocGljRGF0YSkge1xyXG4gICAgICAgICAgbW9kZWwucG9rZW1vbnNbaWRdLnBpY3R1cmUgPSBwaWNEYXRhLnBpY3R1cmU7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucGVybWFsaW5rID0gcGljRGF0YS5wZXJtYWxpbms7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0uYXV0aG9yID0gcGljRGF0YS5hdXRob3I7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9nb3NuYXBTdGF0dXMgPSBwaWNEYXRhLnN0YXR1cztcclxuICAgICAgICAgIG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdLnVwZGF0ZVBva2VJbmZvKG1vZGVsLnBva2Vtb25zW2lkXSk7XHJcbiAgICAgICAgICBNYXBWaWV3LnVwZGF0ZU1hcmtlcihtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBkYXRhIGZyb20gcG9rZWFwaVxyXG4gICAgICBpZiAobW9kZWwucG9rZW1vbnNbaWRdLnBva2VhcGlTdGF0dXMgPT09ICdvaycpIHtcclxuICAgICAgICBtb2RlbC5sb2NhdGlvbnNbbG9jX2lkXS51cGRhdGVQb2tlSW5mbyhtb2RlbC5wb2tlbW9uc1tpZF0pO1xyXG4gICAgICAgIE1hcFZpZXcudXBkYXRlTWFya2VyKG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBwb2tlYXBpLmdldERhdGEoaWQsIGZ1bmN0aW9uIChiaW9EYXRhKSB7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ud2VpZ2h0ID0gYmlvRGF0YS53ZWlnaHQ7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0uaGVpZ2h0ID0gYmlvRGF0YS5oZWlnaHQ7XHJcbiAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0ucG9rZWFwaVN0YXR1cyA9IGJpb0RhdGEuc3RhdHVzO1xyXG4gICAgICAgICAgaWYoYmlvRGF0YS50eXBlcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBiaW9EYXRhLnR5cGVzLmZvckVhY2goZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgICBtb2RlbC5wb2tlbW9uc1tpZF0udHlwZXMucHVzaChpLnR5cGUubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgbW9kZWwubG9jYXRpb25zW2xvY19pZF0udXBkYXRlUG9rZUluZm8obW9kZWwucG9rZW1vbnNbaWRdKTtcclxuICAgICAgICAgIE1hcFZpZXcudXBkYXRlTWFya2VyKG1vZGVsLmxvY2F0aW9uc1tsb2NfaWRdKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSxcclxufTtcclxuY29udHJvbGxlci5pbml0KCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
